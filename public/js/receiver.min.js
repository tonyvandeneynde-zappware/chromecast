var com;function _applyZoom(e){if(e)if(window.innerWidth/1280<window.innerHeight/720){let a=window.innerWidth/1280;e.style.transform="scale("+a+")",e.style.transformOrigin="0 0",e.style.top=(window.innerHeight-720*a)/2+"px"}else{let a=window.innerHeight/720;e.style.transform="scale("+a+")",e.style.transformOrigin="0 0",e.style.left=(window.innerWidth-1280*a)/2+"px"}}void 0===com&&(com={}),com.zappware={},com.zappware.chromecast={},com.zappware.chromecast.cast={init:function(){},sendCustomMessage:function(){}},window.onload=function(){1280===window.innerWidth&&720===window.innerHeight||_applyZoom(document.getElementById("container")),com.zappware.chromecast.cast.init(com.zappware.chromecast.player.getPlaybackConfig()),com.zappware.chromecast.receiver.init()},function(){let e=document.querySelector("iframe#splash");if(!e)return;1280===window.innerWidth&&720===window.innerHeight||_applyZoom(document.getElementById("background"));var a=function(){var a=document.createElement("img");a.id="splash",e.parentNode.replaceChild(a,e)};let t=window.location.search.substring(1);if(t&&(t=new URLSearchParams(t)).get("splash"))return e.src=t.get("splash"),void(e.onerror=a);a()}(),com.zappware.chromecast.GlobalText=function(e){var a=e.default,t=e.map;for(var n in t)t.hasOwnProperty(n)&&e.strings[t[n]]&&(t[n]=e.strings[t[n]]);var r=["longMonthNameJanuary","longMonthNameFebruary","longMonthNameMarch","longMonthNameApril","longMonthNameMay","longMonthNameJune","longMonthNameJuly","longMonthNameAugust","longMonthNameSeptember","longMonthNameOctober","longMonthNameNovember","longMonthNameDecember"],o=["shortMonthNameJanuary","shortMonthNameFebruary","shortMonthNameMarch","shortMonthNameApril","shortMonthNameMay","shortMonthNameJune","shortMonthNameJuly","shortMonthNameAugust","shortMonthNameSeptember","shortMonthNameOctober","shortMonthNameNovember","shortMonthNameDecember"],i=["shortDayNameSunday","shortDayNameMonday","shortDayNameTuesday","shortDayNameWednesday","shortDayNameThursday","shortDayNameFriday","shortDayNameSaturday"],s=["longDayNameSunday","longDayNameMonday","longDayNameTuesday","longDayNameWednesday","longDayNameThursday","longDayNameFriday","longDayNameSaturday"];this.getLanguage=function(){return a},this.setLanguage=function(e){t[e]?a=e:DEBUG&&console.error("Request to set unsupported language: "+e+". Supported languages: "+JSON.stringify(Object.keys(t)))},this.getLongMonthName=function(e){var n=r[e];if(n)return t[a][n]},this.getShortMonthName=function(e){var n=o[e];if(n)return t[a][n]},this.getLongDayName=function(e){var n=s[e];if(n)return t[a][n]},this.getShortDayName=function(e){var n=i[e];if(n)return t[a][n]},this.getString=function(e){if(e)return t[a][e]}},com.zappware.chromecast.globaltext=new com.zappware.chromecast.GlobalText(GLOBALTEXT);var FontDetector=function(){"use strict";var e=["monospace","sans-serif","serif"],a=document.getElementsByTagName("body")[0],t=document.createElement("span");t.style.color="#FFFFFF",t.style.fontSize="72px",t.innerHTML="mmmmmmmmmmlli";var n={},r={};for(var o in e)("string"==typeof o||o instanceof String)&&(t.style.fontFamily=e[o],a.appendChild(t),n[e[o]]=t.offsetWidth,r[e[o]]=t.offsetHeight,a.removeChild(t));this.detect=function(o){var i=!1;for(var s in e)if("string"==typeof s||s instanceof String){t.style.fontFamily=o+","+e[s],a.appendChild(t);var c=t.offsetWidth!==n[e[s]]||t.offsetHeight!==r[e[s]];a.removeChild(t),i=i||c}return i}};function assert(e,a){console.assert(e,a),e||com.zappware.chromecast.cast.sendCustomLogMessage("Assertion failed: "+a)}com.zappware.chromecast.util=function(){function e(e,a,t,n){return new Promise(function(r,o){var i=new XMLHttpRequest;if(i.withCredentials=!1!==t,i.onreadystatechange=function(){4===i.readyState&&(200===i.status?r(i[n]||i.responseText):o(i))},i.onError=function(e){o(e)},i.open("GET",e,!0),a)for(var s in a)a.hasOwnProperty(s)&&i.setRequestHeader(s,a[s]);i.send(null)})}return{getCurrentTime:function(){return(new Date).getTime()/1e3},cloneObject:function(e){return JSON.parse(JSON.stringify(e))},ID:function(e){return document.querySelector(("#"===e[0]?"#":"")+e)},hasClass:function(e,a){return e.classList.contains(a)},changeClass:function(e,a,t){e.className=e.className.replace(new RegExp("(\\s|^)"+a+"(\\s|$)"),"$1"+t+"$2")},removeClass:function(e,a){"use strict";e&&e.classList.remove(a)},addClass:function(e,a){"use strict";e&&e.classList.add(a)},formatDate:function(e,a){"use strict";if("number"==typeof e||e instanceof Date){var t;if("number"==typeof e&&e>864e5&&(e<4102444800&&(e*=1e3),e=new Date(e)),e instanceof Date)t={year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),dayOfWeek:e.getDay(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()};else{var n=a.includes("s")?Math.floor(e/60):Math.ceil(e/60),r=Math.floor(n/60);t={hours:r,minutes:n-60*r,seconds:e-60*n}}return function(e,a){if(!a)return"";var t,n=a.match(/"[^"]*"|'[^']*'/g);if(n)for(t=0;t<n.length;t++)a=a.replace(n[t],"$"+t+"$");var r=""+e.year;a=(a=(a=(a=a.replace("yyyy",r)).replace("yyy",r.substring(1,4))).replace("yy",r.substring(2,4))).replace("y",parseInt(r)%100);var o=e.hours,i=""+o,s=i;o<10&&(s="0"+i),a=(a=a.replace("HH",s)).replace("H",i);var c=""+o%12;"0"===c&&(c="12");var p=c;1===p.length&&(p="0"+c);var l=o<12?"am":"pm",m=o<12?"AM":"PM";a=(a=(a=(a=a.replace("hh",p)).replace("h",c)).replace("a",l)).replace("A",m);var d=e.minutes,u=""+d,h=u;d<10&&(h="0"+u),a=(a=a.replace("mm",h)).replace("m",u);var y=e.seconds,g=""+y,f=g;y<10&&(f="0"+g),a=(a=a.replace("ss",f)).replace("s",g);var _=e.month+1,k=""+_,v=k;_<10&&(v="0"+k),a=(a=(a=(a=(a=(a=(a=a.replace("MMMM","$++++$")).replace("MMM","$+++$")).replace("MM","$++$")).replace("$++++$",com.zappware.chromecast.globaltext.getLongMonthName(e.month))).replace("$+++$",com.zappware.chromecast.globaltext.getShortMonthName(e.month))).replace("$++$",v)).replace("$+$",k);var E=e.day,b=""+E,w=b;if(E<10&&(w="0"+b),a=(a=(a=(a=(a=(a=(a=a.replace("dddd","$++++$")).replace("ddd","$+++$")).replace("dd","$++$")).replace("$++++$",com.zappware.chromecast.globaltext.getLongDayName(e.dayOfWeek))).replace("$+++$",com.zappware.chromecast.globaltext.getShortDayName(e.dayOfWeek))).replace("$++$",w)).replace("$+$",b),n)for(t=0;t<n.length;t++)a=a.replace("$"+t+"$",n[t].substring(1,n[t].length-1));return a}(t,a)}return""},log:function(e,a){var t,n,r,o,i;a||(a=e,e=""),e&&(e="["+e+"] "),t=new Date,n=t.getHours(),r=t.getMinutes(),o=t.getSeconds(),i=t.getMilliseconds(),a=(n<10?"0":"")+n+":"+(r<10?"0":"")+r+":"+(o<10?"0":"")+o+"."+(i<10?"00":i<100?"0":"")+i+" "+e+a,console.info(a),com.zappware.chromecast.cast.sendCustomLogMessage(a)},getAsObject:function(e){if("string"==typeof e||e instanceof String)try{return JSON.parse(e)}catch(e){}return e},httpHead:function(e,a){return new Promise(function(t,n){var r=new XMLHttpRequest;r.timeout=a,r.onreadystatechange=function(){4===r.readyState&&(200===r.status?t():n())},r.onError=r.onTimeout=function(e){n(e)},r.open("HEAD",e,!0),r.send(null)})},httpGet:e,httpGetXML:function(a,t,n){return e(a,t,n,"responseXML")},httpGetRedirectURL:function(a,t,n){return e(a,t,n,"responseURL")},httpPost:function(e,a,t){return new Promise(function(n,r){var o=new XMLHttpRequest;if(o.withCredentials=!0,o.onreadystatechange=function(){4===o.readyState&&(200===o.status?n(o.responseText):r(o))},o.onError=function(e){r(e)},o.open("POST",e,!0),a)for(var i in a)a.hasOwnProperty(i)&&o.setRequestHeader(i,a[i]);o.send(t)})},httpPostSync:function(e,a,t){var n=new XMLHttpRequest;if(n.open("POST",e,!1),a)for(var r in a)a.hasOwnProperty(r)&&n.setRequestHeader(r,a[r]);return n.send(t),n},httpDelete:function(e,a){const t=new XMLHttpRequest;if(t.open("DELETE",e,!0),a)for(var n in a)a.hasOwnProperty(n)&&t.setRequestHeader(n,a[n]);return t.send(),t},xmlToObj:function e(a){"use strict";var t={};if(1===a.nodeType){if(a.attributes.length>0){t["@attributes"]={};for(var n=0,r=a.attributes.length;n<r;n++){var o=a.attributes.item(n);t["@attributes"][o.nodeName]=o.nodeValue}}}else if(3===a.nodeType)return a.nodeValue;if(a.hasChildNodes())for(var i=0,s=a.childNodes.length;i<s;i++){var c=a.childNodes.item(i),p=c.nodeName;if("#text"===p)1===a.childNodes.length?t=e(c):t["@text"]=e(c);else if(void 0===t[p])t[p]=e(c);else{if(!Array.isArray(t[p])){var l=t[p];t[p]=[],t[p].push(l)}t[p].push(e(c))}}else t=void 0;return t},normalizeLanguageIsoCode:function(e){"use strict";switch(e){case"arm":return"hye";case"baq":return"eus";case"tib":return"bod";case"bur":return"mya";case"cze":return"ces";case"chi":return"zho";case"wel":return"cym";case"ger":return"deu";case"bnl":case"dut":return"nld";case"per":return"fas";case"fre":return"fra";case"geo":return"kat";case"gre":return"ell";case"ice":return"isl";case"mac":return"mkd";case"mao":return"mri";case"may":return"msa";case"rum":return"ron";case"slo":return"slk";case"sqi":return"alb";case"scr":return"hrv";case"scc":return"srp";default:return e}},getLanguageFromIsoCode:function(e){var a={af:"Afrikaans","af-ZA":"Afrikaans (South Africa)",ar:"Arabic","ar-AE":"Arabic (U.A.E.)","ar-BH":"Arabic (Bahrain)","ar-DZ":"Arabic (Algeria)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-YE":"Arabic (Yemen)",az:"Azeri (Latin)","az-AZ":"Azeri (Latin) (Azerbaijan)","az-Cyrl-AZ":"Azeri (Cyrillic) (Azerbaijan)",be:"Belarusian","be-BY":"Belarusian (Belarus)",bg:"Bulgarian","bg-BG":"Bulgarian (Bulgaria)","bs-BA":"Bosnian (Bosnia and Herzegovina)",ca:"Catalan","ca-ES":"Catalan (Spain)",cs:"Czech","cs-CZ":"Czech (Czech Republic)",cy:"Welsh","cy-GB":"Welsh (United Kingdom)",da:"Danish","da-DK":"Danish (Denmark)",de:"German","de-AT":"German (Austria)","de-CH":"German (Switzerland)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)",dv:"Divehi","dv-MV":"Divehi (Maldives)",el:"Greek","el-GR":"Greek (Greece)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-CB":"English (Caribbean)","en-GB":"English (United Kingdom)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Republic of the Philippines)","en-TT":"English (Trinidad and Tobago)","en-US":"English (United States)","en-ZA":"English (South Africa)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-ES":"Spanish (Spain)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-PY":"Spanish (Paraguay)","es-SV":"Spanish (El Salvador)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",et:"Estonian","et-EE":"Estonian (Estonia)",eu:"Basque","eu-ES":"Basque (Spain)",fa:"Farsi","fa-IR":"Farsi (Iran)",fi:"Finnish","fi-FI":"Finnish (Finland)",fo:"Faroese","fo-FO":"Faroese (Faroe Islands)",fr:"French","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-CH":"French (Switzerland)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Principality of Monaco)",gl:"Galician","gl-ES":"Galician (Spain)",gu:"Gujarati","gu-IN":"Gujarati (India)",he:"Hebrew","he-IL":"Hebrew (Israel)",hi:"Hindi","hi-IN":"Hindi (India)",hr:"Croatian","hr-BA":"Croatian (Bosnia and Herzegovina)","hr-HR":"Croatian (Croatia)",hu:"Hungarian","hu-HU":"Hungarian (Hungary)",hy:"Armenian","hy-AM":"Armenian (Armenia)",id:"Indonesian","id-ID":"Indonesian (Indonesia)",is:"Icelandic","is-IS":"Icelandic (Iceland)",it:"Italian","it-CH":"Italian (Switzerland)","it-IT":"Italian (Italy)",ja:"Japanese","ja-JP":"Japanese (Japan)",ka:"Georgian","ka-GE":"Georgian (Georgia)",kk:"Kazakh","kk-KZ":"Kazakh (Kazakhstan)",kn:"Kannada","kn-IN":"Kannada (India)",ko:"Korean","ko-KR":"Korean (Korea)",kok:"Konkani","kok-IN":"Konkani (India)",ky:"Kyrgyz","ky-KG":"Kyrgyz (Kyrgyzstan)",lt:"Lithuanian","lt-LT":"Lithuanian (Lithuania)",lv:"Latvian","lv-LV":"Latvian (Latvia)",mi:"Maori","mi-NZ":"Maori (New Zealand)",mk:"FYRO Macedonian","mk-MK":"FYRO Macedonian (Former Yugoslav Republic of Macedonia)",mn:"Mongolian","mn-MN":"Mongolian (Mongolia)",mr:"Marathi","mr-IN":"Marathi (India)",ms:"Malay","ms-BN":"Malay (Brunei Darussalam)","ms-MY":"Malay (Malaysia)",mt:"Maltese","mt-MT":"Maltese (Malta)",nb:"Norwegian (Bokm?l)","nb-NO":"Norwegian (Bokm?l) (Norway)",nl:"Dutch","nl-BE":"Dutch (Belgium)","nl-NL":"Dutch (Netherlands)","nn-NO":"Norwegian (Nynorsk) (Norway)",ns:"Northern Sotho","ns-ZA":"Northern Sotho (South Africa)",pa:"Punjabi","pa-IN":"Punjabi (India)",pl:"Polish","pl-PL":"Polish (Poland)",ps:"Pashto","ps-AR":"Pashto (Afghanistan)",pt:"Portuguese","pt-BR":"Portuguese (Brazil)","pt-PT":"Portuguese (Portugal)",qu:"Quechua","qu-BO":"Quechua (Bolivia)","qu-EC":"Quechua (Ecuador)","qu-PE":"Quechua (Peru)",ro:"Romanian","ro-RO":"Romanian (Romania)",ru:"Russian","ru-RU":"Russian (Russia)",sa:"Sanskrit","sa-IN":"Sanskrit (India)",se:"Sami","se-FI":"Sami (Finland)","se-NO":"Sami (Norway)","se-SE":"Sami (Sweden)",sk:"Slovak","sk-SK":"Slovak (Slovakia)",sl:"Slovenian","sl-SI":"Slovenian (Slovenia)",sq:"Albanian","sq-AL":"Albanian (Albania)","sr-BA":"Serbian (Latin) (Bosnia and Herzegovina)","sr-Cyrl-BA":"Serbian (Cyrillic) (Bosnia and Herzegovina)","sr-SP":"Serbian (Latin) (Serbia and Montenegro)","sr-Cyrl-SP":"Serbian (Cyrillic) (Serbia and Montenegro)",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SE":"Swedish (Sweden)",sw:"Swahili","sw-KE":"Swahili (Kenya)",syr:"Syriac","syr-SY":"Syriac (Syria)",ta:"Tamil","ta-IN":"Tamil (India)",te:"Telugu","te-IN":"Telugu (India)",th:"Thai","th-TH":"Thai (Thailand)",tl:"Tagalog","tl-PH":"Tagalog (Philippines)",tn:"Tswana","tn-ZA":"Tswana (South Africa)",tr:"Turkish","tr-TR":"Turkish (Turkey)",tt:"Tatar","tt-RU":"Tatar (Russia)",ts:"Tsonga",uk:"Ukrainian","uk-UA":"Ukrainian (Ukraine)",ur:"Urdu","ur-PK":"Urdu (Islamic Republic of Pakistan)",uz:"Uzbek (Latin)","uz-UZ":"Uzbek (Latin) (Uzbekistan)","uz-Cyrl-UZ":"Uzbek (Cyrillic) (Uzbekistan)",vi:"Vietnamese","vi-VN":"Vietnamese (Viet Nam)",xh:"Xhosa","xh-ZA":"Xhosa (South Africa)",zh:"Chinese","zh-CN":"Chinese (S)","zh-HK":"Chinese (Hong Kong)","zh-MO":"Chinese (Macau)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (T)",zu:"Zulu","zu-ZA":"Zulu (South Africa)"};return a[e]?a[e]:e},waitFontsLoaded:function e(){return void 0===e._checkFontsLoadedPromise&&(e._checkFontsLoadedPromise=new Promise(function(e,a){if("undefined"!=typeof FONTS&&FONTS.length){var t=new FontDetector,n=0;!function r(){for(var o=0,i=0;i<FONTS.length;i++)t.detect(FONTS[i])&&(o+=1);o!==FONTS.length?(n+=1)>50?a(new Error("Failed to load fonts")):(DEBUG&&com.zappware.chromecast.util.log("Waiting a bit more for font detection"),setTimeout(r,100)):e()}()}else e()})),e._checkFontsLoadedPromise}}}(),com.zappware.chromecast.Error={NO_ERROR:"ZCR_ERR_NO_ERROR",UNEXPECTED_EXCEPTION:"ZCR_ERR_UNEXPECTED_EXCEPTION",SESSION_LIMIT_REACHED:"ZCR_ERR_SESSION_LIMIT_REACHED",SESSION_SERVER_ERROR:"ZCR_ERR_SESSION_SERVER_ERROR",SESSION_SERVER_DOWN:"ZCR_ERR_SESSION_SERVER_DOWN",NOT_AUTHORIZED:"ZCR_ERR_NOT_AUTHORIZED",NO_NETWORK:"ZCR_ERR_NO_NETWORK",PLAYBACK:"ZCR_ERR_PLAYBACK",LOAD_FAILED:"ZCR_ERR_LOAD_FAILED",SEEK_FAILED:"ZCR_ERR_SEEK_FAILED",NO_METADATA:"ZCR_ERR_NO_METADATA",EVENT_BLOCKED:"ZCR_ERR_EVENT_BLOCKED",GRAPHQL_ERROR:"ZCR_ERR_GRAPHQL"},com.zappware.chromecast.ErrorMessage={ZCR_ERR_NO_METADATA:{title:"activateAppTitle",description:"activateAppDescription"}},com.zappware.chromecast.receiver=function(){var e,a={},t={},n={},r=null,o=null,i=null,s=null,c=null,p=null,l=null,m=null,d=1e3,u="undefined"!=typeof DEFAULT_CONFIG?DEFAULT_CONFIG:{language:"eng",showStatistics:!1,bannerTimeout:5,ageRating:18,playback:{audioLanguagePreference:["eng"],subtitleLanguagePreference:["eng"],hardOfHearing:!1,visuallyImpaired:!1},blackout:[],customData:{}},h=com.zappware.chromecast.util.cloneObject(u),y=!1,g=!1,f=function(e){com.zappware.chromecast.util.log("com.zappware.chromecast.receiver",e)};function _(e){com.zappware.chromecast.cast.sendCustomMessage({action:"errorUpdate",params:{mediaSessionToken:r,error:com.zappware.chromecast.Error.NO_METADATA,details:n[r]}}),setTimeout(()=>{o||com.zappware.chromecast.receiver.onError(com.zappware.chromecast.Error.NO_METADATA,n[r])},e||0)}function k(){var e=com.zappware.chromecast.player.getState();DEBUG&&f("_onStateChange(); state = "+e),C(e===com.zappware.chromecast.PlayerState.PAUSED?"Pause":"Play"),U(e===com.zappware.chromecast.PlayerState.PLAYING&&!y&&!g),D()}function v(){y&&(y=void 0,com.zappware.chromecast.cast.sendCustomMessage({action:"lockedUpdate",params:com.zappware.chromecast.receiver.getLocked()})),P(),p&&(clearInterval(p),p=null),z(void 0),i=null,t={}}function E(e,a,t){var n=com.zappware.chromecast.util.cloneObject(t);for(var r in a)if(a.hasOwnProperty(r)){var o="DEFAULT"!==a[r]?a[r]:u[e][r];n[r]=o}return n}function b(){var a={id:o&&o.id||void 0,title:o&&w(o,"title")||void 0,subtitle:o&&w(o,"subtitle")||void 0,start:o&&o.start||void 0,bufferStart:com.zappware.chromecast.player.getMinPosition(),end:o&&o.end||void 0,image:o&&w(o,"image")||void 0,ageRating:o&&o.ageRating||void 0,customData:o&&o.customData||void 0,locked:y,blocked:g,channelId:t.channelId||void 0,channelTitle:t.channelTitle||void 0,channelLogo:t.channelLogo||void 0,mediaSessionToken:r};return e!==com.zappware.chromecast.PlaybackMode.LIVETV&&e!==com.zappware.chromecast.PlaybackMode.PLTV&&(a.start=a.bufferStart=0,i&&(w(i,"title")&&(a.title=w(i,"title")),w(i,"subtitle")&&(a.subtitle=w(i,"subtitle")),w(i,"image")&&(a.image=w(i,"image")),i.hasOwnProperty("ageRating")&&(a.ageRating=Math.max(i.ageRating,a.ageRating||0)),i.hasOwnProperty("start")&&(a.start=i.start),i.hasOwnProperty("end")&&(a.end=i.end),i.hasOwnProperty("bufferStart")&&(a.bufferStart=i.bufferStart),i.hasOwnProperty("customData")&&(a.customData=i.customData),i.hasOwnProperty("end")&&(a.duration=i.end-a.start)),a.duration||(a.duration=Math.floor(com.zappware.chromecast.player.getMaxPosition())||void 0),!a.end&&a.duration&&(a.end=a.start+a.duration)),a}function w(e,a){return A(e)&&e&&e.hasOwnProperty(a+"WhenLocked")?e[a+"WhenLocked"]:e&&e.hasOwnProperty(a)?e[a]:void 0}function P(e){DEBUG&&f("_setLocked("+e+"); blocked = "+g),y=e,com.zappware.chromecast.util.removeClass(document.body,"Splash"),com.zappware.chromecast.util.removeClass(document.body,"Blocked"),com.zappware.chromecast.util.removeClass(document.body,"Locked"),com.zappware.chromecast.util.removeClass(document.body,"Black"),com.zappware.chromecast.util.removeClass(document.body,"Buffering"),com.zappware.chromecast.util.removeClass(document.body,"Error"),!1===y&&!1===g?(com.zappware.chromecast.player.setMuted(!1),I({title:"",description:""}),com.zappware.chromecast.util.hasClass(a.playbackBanner,"hidden")||U()):(com.zappware.chromecast.player.setMuted(!0),com.zappware.chromecast.util.addClass(document.body,g?"Blocked":y?"Locked":"Black"),I({title:g?com.zappware.chromecast.globaltext.getString("contentBlockedTitle"):y?com.zappware.chromecast.globaltext.getString("contentLockedTitle"):"",description:g?com.zappware.chromecast.globaltext.getString("contentBlockedDescription"):y?com.zappware.chromecast.globaltext.getString("contentLockedDescription"):""}),U(!1))}function I(e){var a=T();JSON.stringify(e)!==JSON.stringify(a)&&(S(e),com.zappware.chromecast.cast.sendCustomMessage({action:"displayMessageUpdate",params:T()}))}function S(e){a.displayTitle.innerHTML=e.title||"",a.displayDescription.innerHTML=e.description||"",e.background?a.background.style.background=e.background:e.innerHtml?a.background.innerHTML=e.innerHtml:a.background.style.background="",e.title||e.description||e.background?(G(),com.zappware.chromecast.util.addClass(document.body,"Message")):com.zappware.chromecast.util.removeClass(document.body,"Message")}function T(){return{title:a.displayTitle.innerHTML||"",description:a.displayDescription.innerHTML||"",background:a.background.style.background,innerHtml:a.background.innerHTML}}function M(){if(r&&n[r]){var a,i=com.zappware.chromecast.player.getPosition(),s=n[r][0];if(e===com.zappware.chromecast.PlaybackMode.LIVETV||e===com.zappware.chromecast.PlaybackMode.PLTV||e===com.zappware.chromecast.PlaybackMode.STARTOVER||e===com.zappware.chromecast.PlaybackMode.CUTV||e===com.zappware.chromecast.PlaybackMode.NPVR)for(var c=0;!a&&c<n[r].length;c++)for(var p=(s=n[r][c]).items,l=s.start||0,m=0;p&&m<p.length;m++){var d=p[m];if(parseInt(d.start)<=l+i&&parseInt(d.end)>l+i){a=d;break}}else a=com.zappware.chromecast.util.cloneObject(s.title?s:s.items[0]);if(a){if(o!==a&&JSON.stringify(o)!==JSON.stringify(a)||void 0===t.end)return z(a,s),!0}else if(o)return z(void 0),!0;return!1}}function z(a,n,s){DEBUG&&f("_currentEventUpdated("+JSON.stringify(a)+" // "+JSON.stringify(o)+"); mode = "+e);var c=g,p=y,l=com.zappware.chromecast.player.getState(),m=l===com.zappware.chromecast.PlayerState.PLAYING||l===com.zappware.chromecast.PlayerState.PAUSED||l===com.zappware.chromecast.PlayerState.SEEKING;c!==(g=N(a))&&g&&com.zappware.chromecast.cast.sendCustomMessage({action:"errorUpdate",params:{mediaSessionToken:r,error:com.zappware.chromecast.Error.EVENT_BLOCKED,details:a}}),P(g?y:m?A(a):void 0),p!==y&&com.zappware.chromecast.cast.sendCustomMessage({action:"lockedUpdate",params:com.zappware.chromecast.receiver.getLocked()});var d,u=o&&b();o=a,i=n||i,d=b(),t.title=d.title||"",t.start=parseInt(d.start),t.end=parseInt(d.end),t.end>t.start||(t.end=void 0),d.hasOwnProperty("bufferStart")&&d.bufferStart,(s||JSON.stringify(u)!==JSON.stringify(d))&&com.zappware.chromecast.cast.sendCustomMessage({action:"currentEventUpdate",params:d}),D()}function D(){if(o){var a=playerManager.getMediaInformation();if(e===com.zappware.chromecast.PlaybackMode.LIVETV||e===com.zappware.chromecast.PlaybackMode.PLTV){let e=com.zappware.chromecast.player.getMediaStartAbsoluteTime(a);if(a&&e){function t(e){let a=new cast.framework.messages.GenericMediaMetadata;return a.title=w(e,"title")||"",a.subtitle=w(e,"subtitle")||"",a.images=w(e,"image")?[new cast.framework.messages.Image(w(e,"image"))]:[],a.sectionDuration=e.end-e.start,a.sectionStartAbsoluteTime=e.start,a}a.streamType="LIVE";const e=new cast.framework.messages.ContainerMetadata;e.title=i.channelTitle,e.sections=[];let r=i.items.indexOf(o);for(var n=r-1;n<=r+1;n++)i.items[n]&&e.sections.push(t(i.items[n]));playerManager.getQueueManager().setContainerMetadata(e)}}else a&&(a.streamType="BUFFERED",a.metadata||(a.metadata=new cast.framework.messages.GenericMediaMetadata),a.metadata.title=w(o,"title")||"",a.metadata.subtitle=w(o,"subtitle")||"",a.metadata.images=w(o,"image")?[new cast.framework.messages.Image(w(o,"image"))]:[])}}function A(e){if(e)return!(s>=e.ageRating)&&(h.ageRating<e.ageRating||!(!h.ageRatingLockWhenEqual||h.ageRating!==e.ageRating))}function N(a,n){var r=a&&JSON.parse(a.blocked||!1)||!1;if((e===com.zappware.chromecast.PlaybackMode.LIVETV||e===com.zappware.chromecast.PlaybackMode.PLTV)&&h.blackout&&!r){void 0===n&&(n=com.zappware.chromecast.player.getPosition());for(var o=0;o<h.blackout.length;o++){var i=h.blackout[o];if(i.channelId===t.channelId&&n>=parseInt(i.start)&&n<parseInt(i.end)){r=!0;break}}}return r}function C(e){switch(e){case"Play":com.zappware.chromecast.util.removeClass(a.trickplay,"Pause"),com.zappware.chromecast.util.addClass(a.trickplay,"Play"),com.zappware.chromecast.util.removeClass(a.trickplay,"deactivated");break;case"Pause":com.zappware.chromecast.util.removeClass(a.trickplay,"Play"),com.zappware.chromecast.util.addClass(a.trickplay,"Pause"),com.zappware.chromecast.util.removeClass(a.trickplay,"deactivated");break;default:com.zappware.chromecast.util.removeClass(a.trickplay,"Pause"),com.zappware.chromecast.util.removeClass(a.trickplay,"Play"),com.zappware.chromecast.util.addClass(a.trickplay,"deactivated")}}function O(e){e?com.zappware.chromecast.util.removeClass(a.overlay,"hidden"):com.zappware.chromecast.util.addClass(a.overlay,"hidden")}function R(a){e&&com.zappware.chromecast.util.removeClass(document.body,e),a&&com.zappware.chromecast.util.addClass(document.body,a),e=a}function L(){if(DEBUG&&f("_updateMediaInfo()"),a.mediaTitle.innerText=t.title||"",a.topLine.innerText="",a.startTime.innerText="",a.endTime.innerText="",e!==com.zappware.chromecast.PlaybackMode.VOD&&e!==com.zappware.chromecast.PlaybackMode.NPVR){var n=com.zappware.chromecast.globaltext.getString(h.ampmDateFormat?"formatTimeAMPM":"formatTime"),r=com.zappware.chromecast.globaltext.getString("formatNoTime"),o=com.zappware.chromecast.globaltext.getString(h.ampmDateFormat?"formatDateAMPM":"formatDate");if(a.startTime.innerText=t.start>=0&&com.zappware.chromecast.util.formatDate(t.start,n)||r,a.endTime.innerText=t.end>=0&&com.zappware.chromecast.util.formatDate(t.end,n)||r,void 0!==t.start&&void 0!==t.end){var i=com.zappware.chromecast.util.formatDate(t.start,n)+" - "+com.zappware.chromecast.util.formatDate(t.end,n)+" "+com.zappware.chromecast.util.formatDate(t.start,o);a.topLine.innerText=i}}t.channelLogo?a.channelLogo.src=t.channelLogo:a.channelLogo.removeAttribute("src"),a.channelTitle.innerText=t.channelTitle||""}function B(n){com.zappware.chromecast.util.removeClass(a.playbackBanner,"ready");var r=com.zappware.chromecast.player.getMinPosition(),o=com.zappware.chromecast.player.getMaxPosition();if(void 0===n||void 0===t.start||void 0===t.end||void 0===r||void 0===o)return a.progressForeground.style.width=a.progressBuffer.style.width=0,void(a.progressPlaying&&(a.progressPlaying.style.width=0));var i=0,s=t.end-t.start;e!==com.zappware.chromecast.PlaybackMode.VOD&&e!==com.zappware.chromecast.PlaybackMode.NPVR&&(n<946684800&&(n+=t.start,r+=t.start,o+=t.start),i=t.start,s=t.end),e!==com.zappware.chromecast.PlaybackMode.VOD&&(o<s?com.zappware.chromecast.util.addClass(document.body,"live"):com.zappware.chromecast.util.removeClass(document.body,"live")),com.zappware.chromecast.util.addClass(a.playbackBanner,"ready");var c=t.offset||0;n+=c,r+=c;var p=s-i,l=Math.max(r-i,0),m=Math.min(p,Math.max(o-i+c,0)),d=a.progressBar.getClientRects()[0].width;function u(e){return Math.round(d*e/p)+"px"}a.progressForeground.style.left=0,a.progressForeground.style.width=u(Math.max(0,Math.min(p,l)));var y=Math.max(0,Math.min(p,l)),g=Math.min(p,m)-y;a.progressBuffer.style.left=u(y),a.progressBuffer.style.width=u(g);var f=n-i;if(a.progressMarker){y=Math.max(0,Math.min(p,f)),a.progressMarker.style.left=u(y-a.progressMarker.style.width/2);let e=com.zappware.chromecast.globaltext.getString(Math.floor(n)>=3600?"formatProgressLong":"formatProgressShort");h.ampmDateFormat&&n>946684800&&(e=com.zappware.chromecast.globaltext.getString("formatProgressLongAMPM")||e),e&&(a.progressMarker.innerText=com.zappware.chromecast.util.formatDate(Math.floor(n),e))}if(a.progressPlaying){var _=Math.max(0,Math.min(p,f));y=Math.max(0,Math.min(p,l)),a.progressPlaying.style.left=u(y),a.progressPlaying.style.width=u(_-y)}if(e===com.zappware.chromecast.PlaybackMode.VOD||e===com.zappware.chromecast.PlaybackMode.NPVR){let e=s-i;if(e>0){let t=Math.ceil(Math.max(e-n,0)),r=com.zappware.chromecast.globaltext.getString(t>=3600?"formatDurationLong":"formatDurationShort");a.endTime.innerText=com.zappware.chromecast.util.formatDate(t,r)}}}function G(){DEBUG&&f("_hideBanner()"),com.zappware.chromecast.util.addClass(a.playbackBanner,"hidden"),l&&clearTimeout(l),O(!1),l=null}function U(e){if(void 0===e){var t=com.zappware.chromecast.player.getState();e=t===com.zappware.chromecast.PlayerState.PLAYING&&!y&&!g}DEBUG&&f("_showBanner("+e+")"),com.zappware.chromecast.util.waitFontsLoaded().then(function(){B(com.zappware.chromecast.player.getPosition()),O(!0),com.zappware.chromecast.util.removeClass(a.playbackBanner,"hidden"),l&&clearTimeout(l),e&&(l=setTimeout(G,h.bannerTimeout*d))})}function F(){for(var e=[{m_max:Math.pow(2,10),m_unit:"bps"},{m_max:Math.pow(2,20),m_unit:"Kbps"},{m_max:Math.pow(2,30),m_unit:"Mbps"}],t=playerManager.getStats().streamBandwidth||0,n=0;t>=e[n].m_max&&n<e.length-1;)++n;n>0&&(t=Math.round(10*t/e[n-1].m_max)/10),a.statistics.innerText=com.zappware.chromecast.globaltext.getString("bitrate")+": "+t+" "+e[n].m_unit}return{init:function(){com.zappware.chromecast.util.waitFontsLoaded(),a={mediaTitle:document.querySelector("#mediaTitle"),background:document.querySelector("#background"),playbackBanner:document.querySelector("#playbackBanner"),displayTitle:document.querySelector("#displayTitle"),displayDescription:document.querySelector("#displayDescription"),channelTitle:document.querySelector("#channelTitle"),channelLogo:document.querySelector("#channelLogo"),topLine:document.querySelector("#topLine"),startTime:document.querySelector("#bottomLeft"),endTime:document.querySelector("#bottomRight"),progressBar:document.querySelector("#progressBar"),progressBackground:document.querySelector("#progressBackground"),progressForeground:document.querySelector("#progressForeground"),progressBuffer:document.querySelector("#progressBuffer"),progressMarker:document.querySelector("#progressMarker"),progressPlaying:document.querySelector("#progressPlaying"),trickplay:document.querySelector("#trickplay"),overlay:document.querySelector("#overlay"),statisticsOverlay:document.querySelector("#statisticsOverlay"),statistics:document.querySelector("#statistics")},com.zappware.chromecast.globaltext.setLanguage(h.language),h.showStatistics?com.zappware.chromecast.util.removeClass(a.statisticsOverlay,"hidden"):com.zappware.chromecast.util.addClass(a.statisticsOverlay,"hidden")},onLoad:function(e,a,n){DEBUG&&f("onLoad("+a+")"),p&&(clearInterval(p),p=null),m&&(clearTimeout(m),m=null),o=null,i=null,c=null,g=!1,s=null,R(e),r=a,t={},P(),n&&n.customData&&((n=com.zappware.chromecast.util.getAsObject(n.customData)).mediaSessionToken=r,this.setMetaData(n)),z(o),L()},onPlay:function(){DEBUG&&f("onPlay()"),k()},onBuffering:function(e){if(DEBUG&&f("onBuffering("+e+")"),e)this._stoppedBufferingTimeout&&(clearTimeout(this._stoppedBufferingTimeout),this._stoppedBufferingTimeout=void 0,this._stoppedBufferingAtPosition=void 0),com.zappware.chromecast.util.addClass(document.body,"Buffering");else{var a=this;!function e(t){var n=com.zappware.chromecast.player.getState(),r=n!==com.zappware.chromecast.PlayerState.ERROR&&n!==com.zappware.chromecast.PlayerState.STOPPED&&n!==com.zappware.chromecast.PlayerState.PAUSED;void 0===t&&(t=com.zappware.chromecast.player.getPosition()),r&&t===com.zappware.chromecast.player.getPosition()?a._stoppedBufferingTimeout=setTimeout(e,100,t):(a._stoppedBufferingTimeout=void 0,com.zappware.chromecast.util.removeClass(document.body,"Buffering"))}()}},onPlaying:function(){if(DEBUG&&f("onPlaying() "+r),t.bufferStart=com.zappware.chromecast.player.getPosition(),!p){function a(){var a=com.zappware.chromecast.player.getPosition();e===com.zappware.chromecast.PlaybackMode.LIVETV||e===com.zappware.chromecast.PlaybackMode.PLTV?a>=t.end&&M()&&(L(),o||_(5e3)):(void 0===t.end||o&&o.end<t.start+a)&&M()&&L(),B(a),h.showStatistics&&F(),N(o,a)!==g&&z(o)}p=setInterval(a,d),a()}n[r]&&n[r][0]?(t.channelId=n[r][0].channelId,t.channelLogo=n[r][0].channelLogo,t.channelTitle=n[r][0].channelTitle,M()?L():z(o)):(DEBUG&&f("No metadata for "+r),o=null,i=null,t={bufferStart:t.bufferStart},L()),C("Play"),(o||h.ageRating>21)&&(o||P(!1),U()),o||_()},onPause:function(){DEBUG&&f("onPause()"),k()},onSeeked:function(){DEBUG&&f("onSeeked()"),M()&&L(),k()},onStop:function(){DEBUG&&f("onStop()"),v(),r=null,com.zappware.chromecast.util.addClass(document.body,"Buffering"),m=setTimeout(function(){G(),com.zappware.chromecast.util.removeClass(document.body,"Buffering"),com.zappware.chromecast.util.removeClass(document.body,"Error"),com.zappware.chromecast.util.removeClass(document.body,"Locked"),com.zappware.chromecast.util.removeClass(document.body,"Black"),com.zappware.chromecast.util.addClass(document.body,"Splash")},5e3)},onError:function(e,a){DEBUG&&f("onError("+e+")"),v(),com.zappware.chromecast.util.addClass(document.body,"Error"),c&&c.code===e||(a&&a.length>4e3&&(a=a.substring(0,4e3)),c={code:e,details:a},com.zappware.chromecast.cast.sendCustomMessage({action:"errorUpdate",params:com.zappware.chromecast.receiver.getError()}));var t=r;setTimeout(function(){if(r===t&&com.zappware.chromecast.util.hasClass(document.body,"Error")&&c){var e=T();e.title||e.description||e.background||function(e){let a="onErrorTitle",t="onErrorDescription";com.zappware.chromecast.ErrorMessage[e]&&(com.zappware.chromecast.ErrorMessage[e].title&&(a=com.zappware.chromecast.ErrorMessage[e].title),com.zappware.chromecast.ErrorMessage[e].description&&(t=com.zappware.chromecast.ErrorMessage[e].description)),I({title:com.zappware.chromecast.globaltext.getString(a),description:com.zappware.chromecast.globaltext.getString(t).replace("$CODE$",e)})}(c.code)}},3e3)},setConfig:function(e){for(var t in DEBUG&&f("setConfig("+JSON.stringify(e)+")"),e)if(e.hasOwnProperty(t)&&u.hasOwnProperty(t)){var n="DEFAULT"!==e[t]?e[t]:u[t],r=h[t];switch(h[t]=n,t){case"language":n!==com.zappware.chromecast.globaltext.getLanguage()&&(com.zappware.chromecast.globaltext.setLanguage(n),L());break;case"showStatistics":n!==r&&(n?(com.zappware.chromecast.util.removeClass(a.statisticsOverlay,"hidden"),F()):com.zappware.chromecast.util.addClass(a.statisticsOverlay,"hidden"));break;case"ageRating":n!==r&&o&&z(o);break;case"customData":const{profileId:i}=n,{profileId:s}=r;if(i&&s&&i!==s)return setTimeout(()=>window.close(),2e3),com.zappware.chromecast.receiver.onBuffering(!0),void com.zappware.chromecast.player.shutdown();break;case"playback":case"qos":h[t]=E(t,e[t],r)}}com.zappware.chromecast.player.initialize(h)},getConfig:function(){return h.version=VERSION,com.zappware.chromecast.util.cloneObject(h)},setMetaData:function(e){if(DEBUG&&f("setMetaData("+e.mediaSessionToken+")"),n[e.mediaSessionToken]&&!e.clear?n[e.mediaSessionToken].unshift(e):n[e.mediaSessionToken]=[e],e.mediaSessionToken===r){t.channelId=e.channelId,t.channelLogo=e.channelLogo,t.channelTitle=e.channelTitle,e.title&&(t.title=e.title);var a=o;M(),L(),o?(a||U(),c===com.zappware.chromecast.Error.NO_METADATA&&(c=null)):!c&&com.zappware.chromecast.player.getPosition()>=0&&_(),i=n[e.mediaSessionToken][0]}},getMetaData:function(e){var a=e&&e.mediaSessionToken||r;return a&&n[a]},getCurrentEvent:b,setLocked:function(e){if(DEBUG&&f("setLocked("+e.mediaSessionToken+")"),e.mediaSessionToken===r){let a=y;P(e.locked),!0===a&&!1===y&&(s=o&&o.ageRating||void 0,z(o,i,!0),L(),D())}},getLocked:function(e){return{mediaSessionToken:r,locked:!!y,ageRating:b().ageRating}},setDisplayMessage:S,getDisplayMessage:T,getError:function(){return{mediaSessionToken:r,error:c&&c.code||com.zappware.chromecast.Error.NO_ERROR,details:c&&c.details||void 0}},setCurrentPosition:function(a){if(a.mediaSessionToken===r){const t=com.zappware.chromecast.player.getState(),n="PLAYBACK_PAUSE"===a.resumeState||t===com.zappware.chromecast.PlayerState.PAUSED?com.zappware.chromecast.PlayerState.PAUSED:void 0;e!==com.zappware.chromecast.PlaybackMode.LIVETV&&e!==com.zappware.chromecast.PlaybackMode.PLTV||a.position<946684800&&com.zappware.chromecast.player.getMediaStartAbsoluteTime()&&(a.position=a.position+com.zappware.chromecast.player.getMediaStartAbsoluteTime()),com.zappware.chromecast.player.setPosition(a.position,n),U()}},getCurrentPosition:function(e){if(e.mediaSessionToken===r)return com.zappware.chromecast.player.getPosition()},getMinPosition:function(e){if(e.mediaSessionToken===r)return com.zappware.chromecast.player.getMinPosition()},getMaxPosition:function(e){if(e.mediaSessionToken===r)return com.zappware.chromecast.player.getMaxPosition()},getMediaSessionToken:function(){return r},getCustomData:function(e){var a=com.zappware.chromecast.player.getCustomData(cast.framework.messages.MessageType.MEDIA_STATUS);return a&&(a.mediaSessionToken=r),a},setPlaybackMode:R}}(),com.zappware.chromecast.Stats=function(){var e=function(e){com.zappware.chromecast.util.log("com.zappware.chromecast.Stats",e)},a=[],t=function(){this._handlePlayerManagerEvent=this._handlePlayerManagerEvent.bind(this)};return t.prototype.start=function(){DEBUG&&e("start()");var t=playerManager.getStats().streamBandwidth;a.push({timestamp:com.zappware.chromecast.util.getCurrentTime(),value:t}),playerManager.addEventListener(cast.framework.events.category.DEBUG,this._handlePlayerManagerEvent),playerManager.addEventListener(cast.framework.events.category.CORE,this._handlePlayerManagerEvent)},t.prototype.stop=function(){DEBUG&&e("stop()"),playerManager.removeEventListener(cast.framework.events.category.DEBUG,this._handlePlayerManagerEvent),playerManager.removeEventListener(cast.framework.events.category.CORE,this._handlePlayerManagerEvent)},t.prototype.reset=function(){a=[]},t.prototype.getCurrentBitrate=function(){return playerManager.getStats().streamBandwidth},t.prototype.getAverageBitrate=function(){if(0===a.length)return 0;if(1===a.length)return a[0].value;for(var e=0,t=0,n=0;n<a.length;++n){var r=(n<a.length-1?a[n+1].timestamp:com.zappware.chromecast.util.getCurrentTime())-a[n].timestamp;void 0!==a[n].value&&(t+=a[n].value*r,e+=r)}return Math.round(t/e)},t.prototype.getNbrSwitchesLowerProfile=function(){return this._getNbrSwitches(function(e,a){return e>a})},t.prototype.getNbrSwitchesHigherProfile=function(){return this._getNbrSwitches(function(e,a){return e<a})},t.prototype._getNbrSwitches=function(e){if(a.length<=1)return 0;for(var t=0,n=a[0],r=1;r<a.length;++r)void 0!==a[r].value&&(e(n,a[r].value)&&t++,n=a[r].value);return t},t.prototype._handlePlayerManagerEvent=function(t){switch(t&&t.type){case"PLAY":var n=playerManager.getStats().streamBandwidth;a.push({timestamp:com.zappware.chromecast.util.getCurrentTime(),value:n}),DEBUG&&e("_handlePlayerManagerEvent("+JSON.stringify(t)+"): Added bitrate "+n+"bps");break;case"REQUEST_PAUSE":a.push({timestamp:com.zappware.chromecast.util.getCurrentTime(),value:void 0}),DEBUG&&e("_handlePlayerManagerEvent("+JSON.stringify(t)+"): Added bitrate undefined");break;case"BITRATE_CHANGED":a.push({timestamp:com.zappware.chromecast.util.getCurrentTime(),value:t.totalBitrate}),DEBUG&&e("_handlePlayerManagerEvent("+JSON.stringify(t)+"): Added bitrate "+t.totalBitrate+"bps")}},t}();var context=cast.framework.CastReceiverContext.getInstance(),playerManager=context.getPlayerManager();const CUSTOM_CHANNEL="urn:x-cast:com.zappware.cast.api",CUSTOM_LOG_CHANNEL="urn:x-cast:com.zappware.cast.log";com.zappware.chromecast.cast.init=function(e){function a(e,a){return e instanceof Promise?e.then(function(e){return null===e&&(a=null),a}).catch(function(){}).then(function(){return a}):null===e?null:a}function t(e){if(e)return DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","_onEventThatRequiresStop("+e.type+")"),com.zappware.chromecast.player.shutdown()}function n(e){if(DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","SENDER_DISCONNECTED, senders: "+context.getSenders().length),e&&"requested_by_sender"===e.reason)return setTimeout(()=>window.close(),2e3),com.zappware.chromecast.receiver.onBuffering(!0),com.zappware.chromecast.player.shutdown()}function r(e,a){try{DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","_onCustomEvent("+JSON.stringify(e)+")");var t,n,r=e.action.substring(3),o=e.action.substring(0,3);if("get"!==o&&"set"!==o)return void com.zappware.chromecast.util.log("com.zappware.chromecast.cast","unhandled custom message: "+JSON.stringify(e));com.zappware.chromecast.receiver["get"+r]&&(n=com.zappware.chromecast.receiver["get"+r](e.params)),"set"===o&&(t=com.zappware.chromecast.receiver[e.action](e.params)),(t||Promise.resolve()).then(function(){if("set"===o&&com.zappware.chromecast.receiver["get"+r]){var t=com.zappware.chromecast.receiver["get"+r](e.params);JSON.stringify(t)!==JSON.stringify(n)&&(a=void 0,n=t)}var i={action:r.charAt(0).toLowerCase()+r.substr(1)+"Update",params:n};e.requestId&&(i.requestId=e.requestId),com.zappware.chromecast.cast.sendCustomMessage(i,a)})}catch(e){console.error(e)}}if(context.setLoggerLevel(DEBUG?cast.framework.LoggerLevel.VERBOSE:cast.framework.LoggerLevel.WARNING),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD,function(e){return a(com.zappware.chromecast.player.load(e),e)}),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.STOP,function(e){return a(com.zappware.chromecast.player.stop(),e)}),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PAUSE,function(e){let t=!1;return _.includes(com.zappware.chromecast.cast._externalRequests,e.requestId)&&(t=!0),a(com.zappware.chromecast.player.pause(t),e)}),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PLAY,function(e){return a(com.zappware.chromecast.player.play(),e)}),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.SEEK,function(e){if(DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","Message intercepted: "+JSON.stringify(e)),com.zappware.chromecast.cast._localRequests&&com.zappware.chromecast.cast._localRequests.indexOf(e.requestId)>=0)return DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","local request -> allow to pass"),e;let a=com.zappware.chromecast.receiver.getMediaSessionToken();if(a){let t=void 0===e.currentTime?com.zappware.chromecast.player.getPosition()+e.relativeTime:e.currentTime;if(t>=0){r({action:"setCurrentPosition",params:{mediaSessionToken:a,position:t}}),e.mediaSessionId=void 0;const n=com.zappware.chromecast.adsHandler.getAdsBlocks(),o=playerManager.getMediaInformation().startAbsoluteTime;let i=!0,s=t;(i=Math.abs(t-com.zappware.chromecast.trickplayHandler.getCurrentTimeSec())>31536e3?com.zappware.chromecast.trickplayHandler.canSeek(t+o):com.zappware.chromecast.trickplayHandler.canSeek(t))?(s=com.zappware.chromecast.trickplayHandler.validateRequestedSeekPosition(t))===t&&n.length>0&&n[n.length-1].adEndTime>t+946681200&&(s=com.zappware.chromecast.trickplayHandler.validateRequestedSeekPosition(t+o)-o):s=playerManager.getCurrentTimeSec(),e.currentTime=s}}return e}),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.QUEUE_UPDATE,function(e){return e.jump?a(com.zappware.chromecast.player.jump(e.jump),e):null}),playerManager.setMessageInterceptor(cast.framework.messages.MessageType.MEDIA_STATUS,function(e){if(e.customData=com.zappware.chromecast.receiver.getCustomData(cast.framework.messages.MessageType.MEDIA_STATUS),e.media&&e.media.tracks)for(var a=0;a<e.media.tracks.length;a++){var t=e.media.tracks[a];t.name||"AUDIO"!==t.type&&"TEXT"!==t.type||(t.name=com.zappware.chromecast.util.getLanguageFromIsoCode(t.language))}return e}),playerManager.addEventListener(cast.framework.events.category.CORE,function(e){DEBUG&&"MEDIA_STATUS"!==e.type&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","onPlayerManagerEvent("+JSON.stringify(e)+")"),e.senderId&&"local"!==e.senderId&&function(e){com.zappware.chromecast.cast._externalRequests||(com.zappware.chromecast.cast._externalRequests=[]);const a=e.requestData&&e.requestData.hasOwnProperty("requestId")&&e.requestData.requestId;_.includes(com.zappware.chromecast.cast._externalRequests,a)||(com.zappware.chromecast.cast._externalRequests.unshift(a),com.zappware.chromecast.cast._externalRequests.length>50&&com.zappware.chromecast.cast._externalRequests.pop())}(e);var a=com.zappware.chromecast.player.getState();switch(e.type){case"RATE_CHANGE":if(com.zappware.chromecast.player.getState()===com.zappware.chromecast.PlayerState.PLAYING){let e=playerManager.getCurrentTimeSec(),a=playerManager.getMediaInformation();setTimeout(()=>{a===playerManager.getMediaInformation()&&com.zappware.chromecast.player.getState()===com.zappware.chromecast.PlayerState.PLAYING&&e===playerManager.getCurrentTimeSec()&&com.zappware.chromecast.player.onMediaStalled()},3e3)}break;case"BUFFERING":var t=a!==com.zappware.chromecast.PlayerState.PAUSED&&a!==com.zappware.chromecast.PlayerState.STOPPED&&a!==com.zappware.chromecast.PlayerState.ERROR&&e.isBuffering;com.zappware.chromecast.receiver.onBuffering(t);break;case"PLAYING":com.zappware.chromecast.receiver.onBuffering(!1);break;case"SEEKING":com.zappware.chromecast.receiver.onBuffering(!0);break;case"MEDIA_FINISHED":if(a===com.zappware.chromecast.PlayerState.SEEKING)return;com.zappware.chromecast.player.onMediaFinished(e),com.zappware.chromecast.receiver.onBuffering(!1),playerManager.sendStatus()}if("local"===e.senderId){com.zappware.chromecast.cast._localRequests||(com.zappware.chromecast.cast._localRequests=[]);let a=e.requestData&&e.requestData.hasOwnProperty("requestId")&&e.requestData.requestId;com.zappware.chromecast.cast._localRequests.indexOf(a)<0&&(com.zappware.chromecast.cast._localRequests.unshift(a),com.zappware.chromecast.cast._localRequests.length>10&&com.zappware.chromecast.cast._localRequests.pop())}}),window.addEventListener("beforeunload",t),context.addEventListener(cast.framework.system.EventType.ERROR,t),context.addEventListener(cast.framework.system.EventType.STANDBY_CHANGED,t),context.addEventListener(cast.framework.system.EventType.VISIBILITY_CHANGED,t),context.addEventListener(cast.framework.system.EventType.READY,function(){com.zappware.chromecast.util.log("Starting ZCR VERSION: "+VERSION)}),context.addEventListener(cast.framework.system.EventType.SYSTEM_VOLUME_CHANGED,function(){com.zappware.chromecast.player.getMuted()&&com.zappware.chromecast.player.setMuted(!0)}),context.addEventListener(cast.framework.system.EventType.SENDER_CONNECTED,function(e){DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","SENDER_CONNECTED, senders: "+context.getSenders().length),context.removeEventListener(cast.framework.system.EventType.SENDER_DISCONNECTED,n),setTimeout(()=>context.addEventListener(cast.framework.system.EventType.SENDER_DISCONNECTED,n),2e3)}),context.addCustomMessageListener(CUSTOM_CHANNEL,function(e){try{return r("string"==typeof e.data?JSON.parse(e.data):com.zappware.chromecast.util.cloneObject(e.data),e.senderId)}catch(e){console.error(e)}}),context.getDeviceCapabilities()){var o={maxInactivity:60};o.supportedCommands=cast.framework.messages.Command.PAUSE|cast.framework.messages.Command.SEEK|cast.framework.messages.Command.QUEUE_NEXT|cast.framework.messages.Command.QUEUE_PREV,o.playbackConfig=e,o.customNamespaces={},o.customNamespaces[CUSTOM_CHANNEL]=cast.framework.system.MessageType.JSON,o.customNamespaces[CUSTOM_LOG_CHANNEL]=cast.framework.system.MessageType.STRING,context.start(o)}},com.zappware.chromecast.cast.sendCustomMessage=function(e,a){DEBUG&&com.zappware.chromecast.util.log("com.zappware.chromecast.cast","sendCustomMessage("+JSON.stringify(e)+")"),context.getSenders().length>0&&context.sendCustomMessage(CUSTOM_CHANNEL,a,e)},com.zappware.chromecast.cast.sendCustomLogMessage=function(e){context.getSenders().length>0&&context.sendCustomMessage(CUSTOM_LOG_CHANNEL,void 0,e)},com.zappware.chromecast.Player=function(){var e=function(e){com.zappware.chromecast.util.log("com.zappware.chromecast.player",e)};return class{constructor(){this.playbackConfig=new cast.framework.PlaybackConfig,this.playbackConfig.protectionSystem=cast.framework.ContentProtection.NONE,this.playbackConfig.licenseUrl=void 0,this.playbackConfig.licenseCustomData=void 0,this.playbackConfig.licenseRequestHandler=function(e){e.withCredentials=!0},this._media=[],this._currentMedia=void 0,this._config=void 0}initialize(a){DEBUG&&e("_initialize()"),this._config=com.zappware.chromecast.util.cloneObject(a)}load(a){if(DEBUG&&e("load(); loadRequestData = "+JSON.stringify(a)+"; playerState: "+playerManager.getPlayerState()),DEBUG&&assert(a.customData,"Missing property 'customData' on loadRequestData."),DEBUG&&assert(a.media,"Missing property 'media' on loadRequestData."),DEBUG&&assert(a.media.contentId,"Missing property 'contentId' on loadRequestData."),!this._config)return DEBUG&&e("load(); loadRequestData = "+JSON.stringify(a)+" ignored: not initialized!"),null;if(a.currentPosition=void 0,a.customData=com.zappware.chromecast.util.getAsObject(a.customData),a._loaded)return DEBUG&&e("Already loaded"),a;var t=this;if(this._currentMedia=a.media,this._loading)return DEBUG&&e("another load request is in progress, this one is delayed."),this._loading.then(function(){t._currentMedia===a.media&&playerManager.load(a)}),null;if(this._loading=new Promise(function(e){setTimeout(function(){t._loading=void 0,e()},3e3)}),a.customData.mediaSessionToken&&(a.media.customData?a.media.customData=com.zappware.chromecast.util.getAsObject(a.media.customData):a.media.customData={},a.media.customData.mediaSessionToken=a.customData.mediaSessionToken),this._media.push(a.media),this._state=com.zappware.chromecast.PlayerState.LOADING,a.media._playbackMode=this._getPlaybackMode(a),a.media._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||a.media._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV){a.currentTime&&!a.customData.currentPosition&&a.currentTime>0&&(a.customData.currentPosition=a.currentTime),a.currentTime=void 0,a.media.streamType="LIVE",a.media.startAbsoluteTime=void 0,a.media.duration=void 0;let e=a.customData.currentPosition||com.zappware.chromecast.util.getCurrentTime();a.media._positionInfo={minPosition:e,maxPosition:Math.max(e,com.zappware.chromecast.util.getCurrentTime()),curPosition:e}}else void 0!==a.customData.currentPosition&&(a.currentTime=a.customData.currentPosition),a.currentTime=a.currentTime||0,a.media._positionInfo={minPosition:0,maxPosition:void 0,curPosition:a.currentTime};return com.zappware.chromecast.receiver.onLoad(a.media._playbackMode,a.customData.mediaSessionToken,a.media.metadata),this._reload=function(t){if(a){com.zappware.chromecast.receiver.onBuffering(!0),a._loaded=!0;try{a.activeTrackIds=[];var n=playerManager.getAudioTracksManager().getActiveTrack();n&&a.activeTrackIds.push(n.trackId);var r=playerManager.getTextTracksManager().getActiveTracks();if(r&&r.length)for(var o=0;o<r.length;o++)a.activeTrackIds.push(r[o].trackId)}catch(a){DEBUG&&e("Unexpected exception "+a+" while applying tracks")}if(t)for(var i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);a.media.startAbsoluteTime=void 0,playerManager.load(a)}},this._load(a)}_getPlaybackMode(e){}play(){if(this.canPause())switch(this._state){case com.zappware.chromecast.PlayerState.SEEKING:case com.zappware.chromecast.PlayerState.PAUSED:case com.zappware.chromecast.PlayerState.PLAYING:this._state=com.zappware.chromecast.PlayerState.PLAYING}return com.zappware.chromecast.receiver.onPlay(),this._state===com.zappware.chromecast.PlayerState.PLAYING||null}pause(e=!1){if(this.canPause(null,e))switch(this._state){case com.zappware.chromecast.PlayerState.SEEKING:case com.zappware.chromecast.PlayerState.PAUSED:case com.zappware.chromecast.PlayerState.PLAYING:this._state=com.zappware.chromecast.PlayerState.PAUSED}return com.zappware.chromecast.receiver.onPause(),this._state===com.zappware.chromecast.PlayerState.PAUSED||null}seek(e){return this._state===com.zappware.chromecast.PlayerState.PLAYING||this._state===com.zappware.chromecast.PlayerState.PAUSED||this._state===com.zappware.chromecast.PlayerState.SEEKING||this._reloadAndSeekInProgressForPosition?e:null}jump(a){return DEBUG&&e("jump("+a+")"),(this._state===com.zappware.chromecast.PlayerState.PLAYING||this._state===com.zappware.chromecast.PlayerState.PAUSED||this._state===com.zappware.chromecast.PlayerState.SEEKING||this._reloadAndSeekInProgressForPosition)&&this.canJump(a),null}shutdown(){DEBUG&&e("shutdown()"),document.getElementById("videoPlayer").src="",this._stopSessions(this._media)}stop(){this._state!==com.zappware.chromecast.PlayerState.STOPPED&&(DEBUG&&e("stop()"),this._state=com.zappware.chromecast.PlayerState.STOPPED,com.zappware.chromecast.receiver.onStop(),this._stopSessions(this._media))}_error(a,t){if(this._state!==com.zappware.chromecast.PlayerState.ERROR){DEBUG&&e("_error("+a+")"),document.getElementById("videoPlayer").src="",this._state=com.zappware.chromecast.PlayerState.ERROR,this._stopSessions(),playerManager.setIdleReason("ZCR_ERR");var n=this;com.zappware.chromecast.util.httpHead("/",1e3).catch(function(){}).then(function(){n._state!==com.zappware.chromecast.PlayerState.ERROR&&n._state!==com.zappware.chromecast.PlayerState.STOPPED||com.zappware.chromecast.receiver.onError(a,t)})}}onMediaFinished(a){if(this._state===com.zappware.chromecast.PlayerState.PLAYING||this._state===com.zappware.chromecast.PlayerState.PAUSED)if(DEBUG&&e(`onMediaFinished("${a.endedReason}")`),"ERROR"===a.endedReason)this._error(com.zappware.chromecast.Error.PLAYBACK);else if("END_OF_STREAM"===a.endedReason){var t=playerManager.getMediaInformation()||this._currentMedia;this._stopPLTV&&t._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV?this._stopPLTV():this.stop()}}onMediaStalled(){}getState(){return this._state}setPosition(a,t){var n=playerManager.getMediaInformation();switch(this._state){case com.zappware.chromecast.PlayerState.LOADING:case com.zappware.chromecast.PlayerState.LOADED:case com.zappware.chromecast.PlayerState.ERROR:case com.zappware.chromecast.PlayerState.STOPPED:return;case com.zappware.chromecast.PlayerState.SEEKING:if(this._reloadAndSeekInProgressForPosition)return this._reloadAndSeekInProgressForPosition=a,this._reloadAndSeekPromise}if(!this.canSeek(n,a)){return DEBUG&&e("setPosition("+a+") ignored: setPosition not supported."),void(t===com.zappware.chromecast.PlayerState.PAUSED&&(setTimeout(()=>{playerManager.pause()},0),playerManager.play()))}if((this._state=com.zappware.chromecast.PlayerState.SEEKING,this.getMaxPosition()>this.getMinPosition()&&(a=Math.max(Math.min(a,this.getMaxPosition()),this.getMinPosition())),a=com.zappware.chromecast.trickplayHandler.validateRequestedSeekPosition(a),n._positionInfo&&(n._positionInfo.curPosition=a),n._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||n._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV)&&a>=playerManager.getLiveSeekableRange().end+n.startAbsoluteTime)return Math.abs(a-this.getMaxPosition())<5&&(a=Number.MAX_SAFE_INTEGER),this._reloadAndSeek(a,t);return this._seek(a,t)}isTimeshiftEnabled(e,a){return(e=e||playerManager.getMediaInformation())&&!e._timeshiftEnabled&&(a=a||playerManager.getLiveSeekableRange(),e._timeshiftEnabled=a&&a.end>a.start),e?e._timeshiftEnabled:void 0}canPause(e){return(e=e||playerManager.getMediaInformation())._playbackMode!==com.zappware.chromecast.PlaybackMode.LIVETV&&e._playbackMode!==com.zappware.chromecast.PlaybackMode.PLTV||this.isTimeshiftEnabled(e)}canSeek(e,a){return(e=e||playerManager.getMediaInformation())._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||e._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV?this.isTimeshiftEnabled(e)&&com.zappware.chromecast.trickplayHandler.canSeek(a):com.zappware.chromecast.trickplayHandler.canSeek(a)}canJump(e,a){if((a=a||playerManager.getMediaInformation()).queueData){var t=playerManager.getQueueManager(),n=t.getItems(),r=t.getCurrentItemIndex()+e;return n&&r>=0&&r<n.length}return!1}_getPositionInfo(e){return(e=e||playerManager.getMediaInformation()||this._currentMedia)&&e._positionInfo&&this._state!==com.zappware.chromecast.PlayerState.ERROR?"IDLE"===playerManager.getPlayerState()||void 0===playerManager.getMediaInformation()||void 0===playerManager.getCurrentTimeSec()||e._positionInfo.timer||this._state===com.zappware.chromecast.PlayerState.STOPPED||this._state===com.zappware.chromecast.PlayerState.LOADING||this._state===com.zappware.chromecast.PlayerState.LOADED||this._state===com.zappware.chromecast.PlayerState.SEEKING?(e._positionInfo.timer&&(clearTimeout(e._positionInfo.timer),e._positionInfo.timer=setTimeout(()=>delete e._positionInfo.timer,0)),e._positionInfo):(e._positionInfo.timer=setTimeout(()=>delete e._positionInfo.timer,0),e._positionInfo.updatedAt=com.zappware.chromecast.util.getCurrentTime(),this._updatePositionInfo(e),com.zappware.chromecast.adsHandler.setTimingForViewedWindow(com.zappware.chromecast.util.getCurrentTime()),com.zappware.chromecast.adsHandler.checkAdEnterExit(),e._positionInfo):{}}_getCurrentPosition(e){if(e._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||e._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV){var a=Math.min(this._reloadAndSeekInProgressForPosition,com.zappware.chromecast.util.getCurrentTime());if(a)return a;var t=playerManager.getCurrentTimeSec(),n=playerManager.getLiveSeekableRange();if(e&&(n&&t>n.start||this._state===com.zappware.chromecast.PlayerState.PAUSED)){if(e.startAbsoluteTime)return e.startAbsoluteTime+t;if(e._playingStartedAt&&this._state!==com.zappware.chromecast.PlayerState.LOADING)return e._playingStartedAt+t}return com.zappware.chromecast.util.getCurrentTime()}return playerManager.getCurrentTimeSec()}_updatePositionInfo(e){if(e._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||e._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV){let a=this._getCurrentPosition(e);this.isTimeshiftEnabled()&&e._playingStartedAt?(e._positionInfo.maxPosition=com.zappware.chromecast.util.getCurrentTime(),e._positionInfo.minPosition=Math.max(e._playingStartedAt,e._positionInfo.maxPosition-this._maxPlaybackOffset),e._positionInfo.curPosition=Math.max(Math.min(a||Number.MAX_SAFE_INTEGER,e._positionInfo.maxPosition),e._positionInfo.minPosition)):e._positionInfo.curPosition=e._positionInfo.minPosition=e._positionInfo.maxPosition=a}else{var a;e._positionInfo.curPosition=playerManager.getCurrentTimeSec(),e._positionInfo.minPosition=0,e._playbackMode!==com.zappware.chromecast.PlaybackMode.STARTOVER&&e._playbackMode!==com.zappware.chromecast.PlaybackMode.NPVR||(a=playerManager.getLiveSeekableRange()),e._positionInfo.maxPosition=a?a.end:playerManager.getDurationSec()}}getPosition(e){return this._getPositionInfo(e).curPosition}getMinPosition(e){return this._getPositionInfo(e).minPosition}getMaxPosition(e){return this._getPositionInfo(e).maxPosition}setMuted(e){this._muted=e,document.getElementById("videoPlayer").muted=!!e}getMuted(){return this._muted}getCustomData(e){var a=playerManager.getMediaInformation();return{minPosition:this.getMinPosition(),currentPosition:this.getPosition(),maxPosition:this.getMaxPosition(),playbackMode:a&&a._playbackMode}}getPlaybackConfig(){return this.playbackConfig}getMediaStartAbsoluteTime(a,t){if(!(a=a||playerManager.getMediaInformation()||this._currentMedia).startAbsoluteTime||t){var n=playerManager.getLiveSeekableRange();n&&n.end>n.start&&(a.startAbsoluteTime=com.zappware.chromecast.util.getCurrentTime()-n.end,a._offsetToLive&&(DEBUG&&e("media._offsetToLive was set: adding another "+a._offsetToLive+"s"),a.startAbsoluteTime+=a._offsetToLive),DEBUG&&e("media.startAbsoluteTime was not set: set it to "+a.startAbsoluteTime))}return a.startAbsoluteTime}_load(a){var t=this,n=a.media;DEBUG&&e("player._load()");var r=this._media.slice(0);r.splice(r.indexOf(n),1),this._stopSessions(r).then(function(){t._loadSession(a.media,a.customData).then(function(a){DEBUG&&e("player._loadSession() done -> proceeding: "+(n===t._currentMedia)),n===t._currentMedia&&a&&(DEBUG&&e("Load failure: Error "+a+" during load request."),playerManager.stop(),t._state!==com.zappware.chromecast.PlayerState.ERROR&&t._error(a||com.zappware.chromecast.Error.LOAD_FAILED))})});var o=this._config.qos;this.playbackConfig.autoPauseDuration=o.autoPauseDuration,this.playbackConfig.autoResumeDuration=o.autoResumeDuration,this.playbackConfig.autoResumeNumberOfSegments=o.autoResumeNumberOfSegments,this.playbackConfig.initialBandwidth=o.initialBandwidth;var i=setTimeout(function(){n===t._currentMedia&&t._state!==com.zappware.chromecast.PlayerState.ERROR&&(DEBUG&&e("Load failure: Did not receive PLAYING event in time."),t._error(com.zappware.chromecast.Error.LOAD_FAILED))},o.maxLoadDuration),s=function(){t._state!==com.zappware.chromecast.PlayerState.PLAYING&&(DEBUG&&e(`${t._state} -> PLAYING`),t._state=com.zappware.chromecast.PlayerState.PLAYING),com.zappware.chromecast.receiver.onPlaying(),clearTimeout(i),n._stats=new com.zappware.chromecast.Stats,n._stats.start(),playerManager.removeEventListener(cast.framework.events.category.CORE,p)},c=function(e){t._error(e&&6===e.errorCode?com.zappware.chromecast.Error.NOT_AUTHORIZED:com.zappware.chromecast.Error.LOAD_FAILED),clearTimeout(i)},p=function(r){if("REQUEST_LOAD"===r.type||n!==t._currentMedia||t._reloadAndSeekInProgressForPosition)playerManager.removeEventListener(cast.framework.events.category.CORE,p);else{if(!playerManager.getMediaInformation())return DEBUG&&e("No media? This is fatal."),playerManager.removeEventListener(cast.framework.events.category.CORE,p),void c();switch(DEBUG&&assert(n===playerManager.getMediaInformation(),"Unexpected change of media!"),r.type){case"ERROR":t._state!==com.zappware.chromecast.PlayerState.LOADING||t._isHarmless(r)||(DEBUG&&e("LOADING -> ERROR"),c(r));break;case"PLAYER_LOAD_COMPLETE":t._state=com.zappware.chromecast.PlayerState.LOADED,n._playingStartedAt=com.zappware.chromecast.util.getCurrentTime(),t.getMediaStartAbsoluteTime(n,!0),"PLAYING"===playerManager.getPlayerState()&&void 0===a.customData.currentPosition&&s();break;case"SEEKING":if(t._state===com.zappware.chromecast.PlayerState.LOADED){if(a.customData.currentPosition>=0){t._state=com.zappware.chromecast.PlayerState.SEEKING;let e=t.setPosition(a.customData.currentPosition);e instanceof Promise&&(e.then(function(){s()}),playerManager.removeEventListener(cast.framework.events.category.CORE,p),clearTimeout(i)),a.customData.currentPosition=void 0}t._selectPreferredTracks(t._config.playback)}break;case"PLAYING":s()}}};return playerManager.addEventListener(cast.framework.events.category.CORE,p),a}_waitForEvent(e,a){var t=this;return this._waitForEvents([e,,"ERROR"],a,function(e){return e&&"ERROR"!==e.type||!t._isHarmless(e)})}_waitForEvents(e,a,t){return new Promise(function(n){var r=a&&setTimeout(i,a),o=function(a){a&&e.indexOf(a.type)>=0&&(t&&!t(a)||i(a))};function i(e){r&&clearTimeout(r),playerManager.removeEventListener(cast.framework.events.category.CORE,o),n(e)}playerManager.addEventListener(cast.framework.events.category.CORE,o)})}_selectPreferredTracks(a){try{if(a.audioLanguagePreference&&a.audioLanguagePreference.length&&(DEBUG&&e("Selecting audio track:"),this._selectPreferredTrack(playerManager.getAudioTracksManager(),a.audioLanguagePreference)),a.subtitleLanguagePreference&&a.subtitleLanguagePreference.length){DEBUG&&e("Selecting subtitle track:"),this._selectPreferredTrack(playerManager.getTextTracksManager(),a.subtitleLanguagePreference);var t=new cast.framework.messages.TextTrackStyle;t.backgroundColor="#00000000",t.fontFamily="Droid Sans",t.edgeType=cast.framework.messages.TextTrackEdgeType.RAISED,t.edgeColor="#00000011",playerManager.getTextTracksManager().setTextTrackStyle(t)}}catch(a){DEBUG&&e("Unexpected exception "+a+" while selecting preferred tracks")}}_selectPreferredTrack(a,t){var n,r;try{n=a.getTracks()}catch(a){DEBUG&&e("getTracks failed: "+a)}try{var o=a.getActiveTrack&&a.getActiveTrack()||a.getActiveTracks()[0];o&&(r=com.zappware.chromecast.util.normalizeLanguageIsoCode(o.language))}catch(a){DEBUG&&e("getActiveTrack failed: "+a)}if(n&&n.length&&t&&t.length){DEBUG&&e("available tracks: "+JSON.stringify(n)+")");for(var i=[],s=0;s<n.length;s++)i.push(com.zappware.chromecast.util.normalizeLanguageIsoCode(n[s].language));DEBUG&&e("available languages: "+JSON.stringify(i)+")"),DEBUG&&e("preferences: "+JSON.stringify(t)+")");for(var c=0;c<t.length;c++){var p=i.indexOf(t[c]);if(p>=0){if(i[p]===r){DEBUG&&e("language ("+r+") already active -> no need to select track.");break}DEBUG&&e("select track: "+JSON.stringify(n[p])+")"),a.setActiveById?a.setActiveById(n[p].trackId):a.setActiveByIds([n[p].trackId]);break}}}}_seek(a,t){var n=playerManager.getMediaInformation();if(n._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||n._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV){a-=n.startAbsoluteTime;var r=playerManager.getLiveSeekableRange();r&&r.end>r.start&&(a=Math.min(Math.max(a,r.start),r.end)),a<n._offsetToLive&&(a=n._offsetToLive)}n._playbackMode!==com.zappware.chromecast.PlaybackMode.LIVETV&&this.getState()===com.zappware.chromecast.PlayerState.PLAYING&&(DEBUG&&e("calling pause before seek "+a),playerManager.pause());var o=Promise.resolve();a!==playerManager.getCurrentTimeSec()&&(DEBUG&&e("calling seek "+a),playerManager.seek(a),o=this._waitForEvent("SEEKED")),t!==com.zappware.chromecast.PlayerState.PAUSED&&(t=com.zappware.chromecast.PlayerState.PLAYING);var i=this,s=this._currentMedia;return o.then(function(e){if(s===i._currentMedia)return"PLAYING"!==playerManager.getPlayerState()&&t===com.zappware.chromecast.PlayerState.PLAYING?(playerManager.play(),i._waitForEvent("PLAYING")):"PAUSED"!==playerManager.getPlayerState()&&t===com.zappware.chromecast.PlayerState.PAUSED?(playerManager.pause(),i._waitForEvent("PAUSE")):void 0}).then(function(e){if(s===i._currentMedia){t===com.zappware.chromecast.PlayerState.PAUSED&&(setTimeout(()=>{playerManager.pause()},3e3),playerManager.play()),i._state=t,com.zappware.chromecast.receiver.onSeeked()}})}_reloadAndSeek(a,t){DEBUG&&e("_reloadAndSeek("+a+")");var n=this;return this._reloadAndSeekInProgressForPosition=a,this._reloadAndSeekObject={},this._reloadAndSeekPromise?this._reloadAndSeekPromise.then(function(){return n._reloadAndSeek(a,t)}):(this._reloadAndSeekPromise=new Promise(function(r){var o=n._currentMedia,i=n._reloadAndSeekObject,s=!1;function c(e){n._reloadAndSeekObject===i&&(n._reloadAndSeekInProgressForPosition=void 0),n._reloadAndSeekPromise=void 0,playerManager.removeEventListener(cast.framework.events.category.CORE,p),r(e)}function p(r){if(r&&"PLAYER_LOAD_COMPLETE"===r.type&&(s=!0),n._currentMedia!==o||s&&n._reloadAndSeekObject!==i)return DEBUG&&e(`_reloadAndSeek(${a}) was interrupted by another (re)load request -> bailing out`),void c();switch(r&&r.type){case"PLAYER_LOAD_COMPLETE":o!==playerManager.getMediaInformation()&&(DEBUG&&e("Media change when reloading"),DEBUG&&assert(n._media.indexOf(o)>=0,"media not in backlog?"),n._media[n._media.indexOf(o)]=n._currentMedia=o=playerManager.getMediaInformation()),n.getMediaStartAbsoluteTime(o,!0),n.getState()===com.zappware.chromecast.PlayerState.SEEKING&&(o._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV?playerManager.play():n._seek(a,t));break;case"PLAYING":case"SEEKED":DEBUG&&e("_reloadAndSeek("+a+") -> done !!! "),c(o);break;case"ERROR":n._isHarmless(r)||(DEBUG&&e("_reloadAndSeek("+a+") -> ERROR !!! "),n._error(com.zappware.chromecast.Error.SEEK_FAILED),c())}}playerManager.addEventListener(cast.framework.events.category.CORE,p),n._reload({currentTime:void 0})}),this._reloadAndSeekPromise)}_isHarmless(e){switch(e.detailedErrorCode){case cast.framework.events.DetailedErrorCode.MEDIA_ERROR_MESSAGE:if(e.error&&"INVALID_REQUEST"===e.error.type)return!0}return!1}_stopSessions(a){a=a||this._media;var t=[];DEBUG&&e("stopping media sessions ("+a.length+")");for(var n=0;n<a.length;n++){var r=a[n];r._stats&&r._stats.stop();var o=this._stop(r);o instanceof Promise&&t.push(o);var i=this._media.indexOf(r);i>-1&&this._media.splice(i,1)}return t.length>1?Promise.all(t):t.length?t[0]:Promise.resolve()}}}(),com.zappware.chromecast.PlayerState={STOPPED:0,LOADING:1,LOADED:2,PLAYING:3,PAUSED:4,SEEKING:5,ERROR:6},com.zappware.chromecast.PlaybackMode={LIVETV:"LIVETV",PLTV:"PLTV",STARTOVER:"STARTOVER",CUTV:"CUTV",NPVR:"NPVR",VOD:"VOD"},com.zappware.chromecast.Nexx4Player=function(){var e=function(e){com.zappware.chromecast.util.log("com.zappware.chromecast.Nexx4Player",e)},a={playChannel:{operationName:"playChannel",variables:{input:void 0},query:"mutation playChannel($input: PlayChannelInput!) {\n  playChannel(input: $input) {\n    playbackInfo {\n      sessionId\n      url\n      channel {\n        id\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},pauseLiveChannel:{operationName:"pauseLiveChannel",variables:{input:void 0},query:"mutation pauseLiveChannel($input: PauseLiveChannelInput!) {\n  pauseLiveChannel(input: $input) {\n    playbackInfo {\n      url\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      playbackRestrictions {\n        message\n        __typename\n      }\n      event {\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      streamStart\n      streamEnd\n      maximumBufferSize\n      endOfStreamBehaviour\n      __typename\n    }\n    __typename\n  }\n}\n"},playVODAsset:{operationName:"playVODAsset",variables:{input:void 0},query:"mutation playVODAsset($input: PlayVODAssetInput!) {\n  playVODAsset(input: $input) {\n    playbackInfo {\n      deliveryKind\n      url\n      endOfEpisodeOffset\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      vodAsset {\n        id\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setVODBookmark:{operationName:"setVODBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setVODBookmark($input: SetVODBookmarkInput!, $profileId: ID!) {\n  setVODBookmark(input: $input) {\n    vodAsset {\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalVODInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalVODInfoFragment on PersonalVODInfo {\n  ...cacheInfoFragment\n  bookmark {\n    ...bookmarkFragment\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n\nfragment bookmarkFragment on Bookmark {\n  ...cacheInfoFragment\n  position\n  audio\n  subtitle\n  __typename\n}\n"},playTrailer:{operationName:"playTrailer",variables:{input:void 0},query:"mutation playTrailer($input: PlayTrailerInput!) {\n  playTrailer(input: $input) {\n    playbackInfo {\n      deliveryKind\n      url\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},playRecording:{operationName:"playRecording",variables:{input:void 0},query:"mutation playRecording($input: PlayRecordingInput!) {\n  playRecording(input: $input) {\n    playbackInfo {\n      url\n      sessionId\n      recording {\n        start\n        end\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setRecordingBookmark:{operationName:"setRecordingBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setRecordingBookmark($input: SetRecordingBookmarkInput!, $profileId: ID!) {\n  setRecordingBookmark(input: $input) {\n    recording {\n      start\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalRecordingInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalRecordingInfoFragment on PersonalRecordingInfo {\n  bookmark {\n    ...cacheInfoFragment\n    position\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n"},restartEvent:{operationName:"restartEvent",variables:{input:void 0},query:"mutation restartEvent($input: RestartEventInput!) {\n  restartEvent(input: $input) {\n    playbackInfo {\n      url\n      streamStart\n      streamEnd\n      sessionId\n      event {\n        id\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},catchupEvent:{operationName:"catchupEvent",variables:{input:void 0},query:"mutation catchupEvent($input: CatchupEventInput!) {\n  catchupEvent(input: $input) {\n    playbackInfo {\n      url\n      streamStart\n      streamEnd\n      sessionId\n      event {\n        id\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setEventBookmark:{operationName:"setEventBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setEventBookmark($input: SetEventBookmarkInput!, $profileId: ID!) {\n  setEventBookmark(input: $input) {\n    event {\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalEventInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalEventInfoFragment on PersonalEventInfo {\n  ...cacheInfoFragment\n  recordings(kindFilter: NETWORK) {\n    ... on NetworkRecording {\n      id\n      start\n      end\n      status\n      availableUntil\n      personalRecordingInfo: personalInfo(profileId: $profileId) {\n        ...personalRecordingInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  bookmark {\n    ...bookmarkFragment\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n\nfragment bookmarkFragment on Bookmark {\n  ...cacheInfoFragment\n  position\n  audio\n  subtitle\n  __typename\n}\n\nfragment personalRecordingInfoFragment on PersonalRecordingInfo {\n  bookmark {\n    ...cacheInfoFragment\n    position\n    __typename\n  }\n  __typename\n}\n"},keepAlive:{operationName:"keepAlive",variables:{},query:"mutation keepAlive {\n  keepSessionAlive {\n    sessionTimeout\n    __typename\n  }\n}\n"},stopPlayback:{operationName:"stopPlayback",variables:{input:void 0},query:"mutation stopPlayback($input: StopPlaybackInput!) {\n  stopPlayback(input: $input) {\n    success\n    __typename\n  }\n}\n"},getCurrentEvent:{operationName:"getCurrentEvent",variables:{},query:"query getCurrentEvent($channelId: ID!, $time: Date!) {\n  channel(id: $channelId) {\n    eventsAt(time: $time, previous: 0, following: 0) {\n      id\n      expiry\n      items {\n        ...nowPlayingEventFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\n\nfragment nowPlayingEventFragment on Event {\n  ...eventInfoBasicFragment\n  __typename\n}\n\nfragment eventInfoBasicFragment on Event {\n  id\n  title\n  start\n  end\n  __typename\n}\n"}},t={playChannel:{operationName:"playChannel",variables:{input:void 0},query:"mutation playChannel($input: PlayChannelInput!) {\n  playChannel(input: $input) {\n    playbackInfo {\n      sessionId\n      url\n    adPlaybackRestrictions\n     channel {\n        id\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},pauseLiveChannel:{operationName:"pauseLiveChannel",variables:{input:void 0},query:"mutation pauseLiveChannel($input: PauseLiveChannelInput!) {\n  pauseLiveChannel(input: $input) {\n    playbackInfo {\n      url\n      sessionId\n    adPlaybackRestrictions\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      playbackRestrictions {\n        message\n        __typename\n      }\n      event {\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      streamStart\n      streamEnd\n      maximumBufferSize\n      endOfStreamBehaviour\n      __typename\n    }\n    __typename\n  }\n}\n"},playVODAsset:{operationName:"playVODAsset",variables:{input:void 0},query:"mutation playVODAsset($input: PlayVODAssetInput!) {\n  playVODAsset(input: $input) {\n    playbackInfo {\n      deliveryKind\n      url\n      endOfEpisodeOffset\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      vodAsset {\n        id\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setVODBookmark:{operationName:"setVODBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setVODBookmark($input: SetVODBookmarkInput!, $profileId: ID!) {\n  setVODBookmark(input: $input) {\n    vodAsset {\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalVODInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalVODInfoFragment on PersonalVODInfo {\n  ...cacheInfoFragment\n  bookmark {\n    ...bookmarkFragment\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n\nfragment bookmarkFragment on Bookmark {\n  ...cacheInfoFragment\n  position\n  audio\n  subtitle\n  __typename\n}\n"},playTrailer:{operationName:"playTrailer",variables:{input:void 0},query:"mutation playTrailer($input: PlayTrailerInput!) {\n  playTrailer(input: $input) {\n    playbackInfo {\n      deliveryKind\n      url\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},playRecording:{operationName:"playRecording",variables:{input:void 0},query:"mutation playRecording($input: PlayRecordingInput!) {\n  playRecording(input: $input) {\n    playbackInfo {\n      url\n      sessionId\n    adPlaybackRestrictions\n     recording {\n        start\n        end\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setRecordingBookmark:{operationName:"setRecordingBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setRecordingBookmark($input: SetRecordingBookmarkInput!, $profileId: ID!) {\n  setRecordingBookmark(input: $input) {\n    recording {\n      start\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalRecordingInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalRecordingInfoFragment on PersonalRecordingInfo {\n  bookmark {\n    ...cacheInfoFragment\n    position\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n"},restartEvent:{operationName:"restartEvent",variables:{input:void 0},query:"mutation restartEvent($input: RestartEventInput!) {\n  restartEvent(input: $input) {\n    playbackInfo {\n      url\n      streamStart\n      streamEnd\n      sessionId\n    adPlaybackRestrictions\n     event {\n        id\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},catchupEvent:{operationName:"catchupEvent",variables:{input:void 0},query:"mutation catchupEvent($input: CatchupEventInput!) {\n  catchupEvent(input: $input) {\n    playbackInfo {\n      url\n      streamStart\n      streamEnd\n      sessionId\n    adPlaybackRestrictions\n      event {\n        id\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setEventBookmark:{operationName:"setEventBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setEventBookmark($input: SetEventBookmarkInput!, $profileId: ID!) {\n  setEventBookmark(input: $input) {\n    event {\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalEventInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalEventInfoFragment on PersonalEventInfo {\n  ...cacheInfoFragment\n  recordings(kindFilter: NETWORK) {\n    ... on NetworkRecording {\n      id\n      start\n      end\n      status\n      availableUntil\n      personalRecordingInfo: personalInfo(profileId: $profileId) {\n        ...personalRecordingInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  bookmark {\n    ...bookmarkFragment\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n\nfragment bookmarkFragment on Bookmark {\n  ...cacheInfoFragment\n  position\n  audio\n  subtitle\n  __typename\n}\n\nfragment personalRecordingInfoFragment on PersonalRecordingInfo {\n  bookmark {\n    ...cacheInfoFragment\n    position\n    __typename\n  }\n  __typename\n}\n"},keepAlive:{operationName:"keepAlive",variables:{},query:"mutation keepAlive {\n  keepSessionAlive {\n    sessionTimeout\n    __typename\n  }\n}\n"},stopPlayback:{operationName:"stopPlayback",variables:{input:void 0},query:"mutation stopPlayback($input: StopPlaybackInput!) {\n  stopPlayback(input: $input) {\n    success\n    __typename\n  }\n}\n"},getCurrentEvent:{operationName:"getCurrentEvent",variables:{},query:"query getCurrentEvent($channelId: ID!, $time: Date!) {\n  channel(id: $channelId) {\n    eventsAt(time: $time, previous: 0, following: 0) {\n      id\n      expiry\n      items {\n        ...nowPlayingEventFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\n\nfragment nowPlayingEventFragment on Event {\n  ...eventInfoBasicFragment\n  __typename\n}\n\nfragment eventInfoBasicFragment on Event {\n  id\n  title\n  start\n  end\n  __typename\n}\n"}},n={playChannel:{operationName:"playChannel",variables:{input:void 0},query:"mutation playChannel($input: PlayChannelInput!) {\n  playChannel(input: $input) {\n    playbackInfo {\n      sessionId\n      url\n    adPlaybackRestrictions\n     adSignallingType\n     trickplayRestrictions\n      channel {\n        id\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},pauseLiveChannel:{operationName:"pauseLiveChannel",variables:{input:void 0},query:"mutation pauseLiveChannel($input: PauseLiveChannelInput!) {\n  pauseLiveChannel(input: $input) {\n    playbackInfo {\n      url\n      sessionId\n    adPlaybackRestrictions\n      adSignallingType\n     trickplayRestrictions\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      playbackRestrictions {\n        message\n        __typename\n      }\n      event {\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      streamStart\n      streamEnd\n      maximumBufferSize\n      endOfStreamBehaviour\n      __typename\n    }\n    __typename\n  }\n}\n"},playVODAsset:{operationName:"playVODAsset",variables:{input:void 0},query:"mutation playVODAsset($input: PlayVODAssetInput!) {\n  playVODAsset(input: $input) {\n    playbackInfo {\n      deliveryKind\n      url\n      endOfEpisodeOffset\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      vodAsset {\n        id\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setVODBookmark:{operationName:"setVODBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setVODBookmark($input: SetVODBookmarkInput!, $profileId: ID!) {\n  setVODBookmark(input: $input) {\n    vodAsset {\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalVODInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalVODInfoFragment on PersonalVODInfo {\n  ...cacheInfoFragment\n  bookmark {\n    ...bookmarkFragment\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n\nfragment bookmarkFragment on Bookmark {\n  ...cacheInfoFragment\n  position\n  audio\n  subtitle\n  __typename\n}\n"},playTrailer:{operationName:"playTrailer",variables:{input:void 0},query:"mutation playTrailer($input: PlayTrailerInput!) {\n  playTrailer(input: $input) {\n    playbackInfo {\n      deliveryKind\n      url\n      sessionId\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},playRecording:{operationName:"playRecording",variables:{input:void 0},query:"mutation playRecording($input: PlayRecordingInput!) {\n  playRecording(input: $input) {\n    playbackInfo {\n      url\n      sessionId\n    adPlaybackRestrictions\n      adSignallingType\n     trickplayRestrictions\n      recording {\n        start\n        end\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setRecordingBookmark:{operationName:"setRecordingBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setRecordingBookmark($input: SetRecordingBookmarkInput!, $profileId: ID!) {\n  setRecordingBookmark(input: $input) {\n    recording {\n      start\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalRecordingInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalRecordingInfoFragment on PersonalRecordingInfo {\n  bookmark {\n    ...cacheInfoFragment\n    position\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n"},restartEvent:{operationName:"restartEvent",variables:{input:void 0},query:"mutation restartEvent($input: RestartEventInput!) {\n  restartEvent(input: $input) {\n    playbackInfo {\n      url\n      streamStart\n      streamEnd\n      sessionId\n    adPlaybackRestrictions\n      adSignallingType\n     trickplayRestrictions\n     event {\n        id\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},catchupEvent:{operationName:"catchupEvent",variables:{input:void 0},query:"mutation catchupEvent($input: CatchupEventInput!) {\n  catchupEvent(input: $input) {\n    playbackInfo {\n      url\n      streamStart\n      streamEnd\n      sessionId\n    adPlaybackRestrictions\n      adSignallingType\n     trickplayRestrictions\n      event {\n        id\n        channel {\n          id\n          __typename\n        }\n        __typename\n      }\n      heartbeat {\n        ... on HttpHeartbeat {\n          url\n          interval\n          includeAuthHeaders\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},setEventBookmark:{operationName:"setEventBookmark",variables:{input:void 0,profileId:void 0},query:"mutation setEventBookmark($input: SetEventBookmarkInput!, $profileId: ID!) {\n  setEventBookmark(input: $input) {\n    event {\n      ...cacheInfoFragment\n      personalInfo(profileId: $profileId) {\n        ...personalEventInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment personalEventInfoFragment on PersonalEventInfo {\n  ...cacheInfoFragment\n  recordings(kindFilter: NETWORK) {\n    ... on NetworkRecording {\n      id\n      start\n      end\n      status\n      availableUntil\n      personalRecordingInfo: personalInfo(profileId: $profileId) {\n        ...personalRecordingInfoFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  bookmark {\n    ...bookmarkFragment\n    __typename\n  }\n  __typename\n}\n\nfragment cacheInfoFragment on Cacheable {\n  __typename\n  id\n  expiry\n}\n\nfragment bookmarkFragment on Bookmark {\n  ...cacheInfoFragment\n  position\n  audio\n  subtitle\n  __typename\n}\n\nfragment personalRecordingInfoFragment on PersonalRecordingInfo {\n  bookmark {\n    ...cacheInfoFragment\n    position\n    __typename\n  }\n  __typename\n}\n"},keepAlive:{operationName:"keepAlive",variables:{},query:"mutation keepAlive {\n  keepSessionAlive {\n    sessionTimeout\n    __typename\n  }\n}\n"},stopPlayback:{operationName:"stopPlayback",variables:{input:void 0},query:"mutation stopPlayback($input: StopPlaybackInput!) {\n  stopPlayback(input: $input) {\n    success\n    __typename\n  }\n}\n"},getCurrentEvent:{operationName:"getCurrentEvent",variables:{},query:"query getCurrentEvent($channelId: ID!, $time: Date!) {\n  channel(id: $channelId) {\n    eventsAt(time: $time, previous: 0, following: 0) {\n      id\n      expiry\n      items {\n        ...nowPlayingEventFragment\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\n\nfragment nowPlayingEventFragment on Event {\n  ...eventInfoBasicFragment\n  __typename\n}\n\nfragment eventInfoBasicFragment on Event {\n  id\n  title\n  start\n  end\n  __typename\n}\n"}};return class extends com.zappware.chromecast.Player{constructor(){var a,t;super(),this._state=com.zappware.chromecast.PlayerState.STOPPED,this._maxPlaybackOffset=3600,this._keepSessionAliveTimer,CONFIG.ZappwareUserAgent=`chromecast/${VERSION.split(" ")[0]} (Nexx 4.0) ${navigator.userAgent}`,playerManager.addEventListener(["PLAYER_LOAD_COMPLETE","MEDIA_FINISHED"],n=>{DEBUG&&e("onPlayerManagerEvent("+n.type+")"),CONFIG.broadpeakHeartbeatInterval&&(t&&(clearInterval(t),t=void 0),a&&(com.zappware.chromecast.util.httpGet(a+"/teardown",void 0,!1).catch(()=>void 0),a=void 0),n.media&&n.media.contentUrl&&(a=n.media.contentUrl,t=setInterval(()=>com.zappware.chromecast.util.httpGet(a+"/keepalive",void 0,!1).catch(()=>void 0),1e3*CONFIG.broadpeakHeartbeatInterval)))})}initialize(t){if(super.initialize(t),t.customData){let a=com.zappware.chromecast.util.cloneObject(t.customData);for(var n in CONFIG)CONFIG.hasOwnProperty(n)&&a[n]&&CONFIG[n]!==a[n]&&(DEBUG&&e("Updating CONFIG."+n+" to "+a[n]),CONFIG[n]=a[n])}if(this._initializing)return;var r=com.zappware.chromecast.util.cloneObject(a.stopPlayback);r.variables.input={sessionId:""},this._initializing=this._graphql(r);let o={_playbackInfo:this._initializing},i=this._media;i.push(o),o._playbackInfo.catch(function(a){DEBUG&&e("Something went wrong while trying to stop all back-end sessions: "+a)}).then(function(){i.splice(i.indexOf(o),1)})}_getPlaybackMode(e){switch(JSON.parse(e.media.contentId)[0].operationName){case"playChannel":return com.zappware.chromecast.PlaybackMode.LIVETV;case"pauseLiveChannel":return com.zappware.chromecast.PlaybackMode.PLTV;case"restartEvent":return com.zappware.chromecast.PlaybackMode.STARTOVER;case"playVODAsset":case"playTrailer":return com.zappware.chromecast.PlaybackMode.VOD;case"catchupEvent":return com.zappware.chromecast.PlaybackMode.CUTV;case"playRecording":return com.zappware.chromecast.PlaybackMode.NPVR}}_load(a){var t=this,n=this._media.indexOf(a.media),r=this._media[n-1],o=!!r&&r._playbackInfo,i=a.media;if(DEBUG&&e("_load()"),o instanceof Promise)return o.then(function(){return t._load(a)});r&&this._setBookmark(r),i._customData=com.zappware.chromecast.util.cloneObject(this._config.customData),a.customData.config&&a.customData.config.playback&&(i._customData.playbackConfig=a.customData.config.playback),i._playbackMode!==com.zappware.chromecast.PlaybackMode.LIVETV||this._hasPLTV(i)?(playerManager.addSupportedMediaCommands(cast.framework.messages.Command.PAUSE),playerManager.addSupportedMediaCommands(cast.framework.messages.Command.SEEK)):(playerManager.removeSupportedMediaCommands(cast.framework.messages.Command.PAUSE),playerManager.removeSupportedMediaCommands(cast.framework.messages.Command.SEEK));var s=JSON.parse(i.contentId)[0];return o&&(o.sessionId&&(s.variables.input.replaceSessionId=o.sessionId),this._annihilatePlaybackInfo(o)),i._playbackMode!==com.zappware.chromecast.PlaybackMode.STARTOVER&&i._playbackMode!==com.zappware.chromecast.PlaybackMode.CUTV&&i._playbackMode!==com.zappware.chromecast.PlaybackMode.VOD&&i._playbackMode!==com.zappware.chromecast.PlaybackMode.NPVR||void 0===a.customData.currentPosition&&(a.customData.currentPosition=0),this.playbackConfig.manifestHandler&&this.playbackConfig.___workaround&&(this.playbackConfig.manifestHandler=this.playbackConfig.___workaround.manifestHandler,this.playbackConfig.___workaround=void 0),this.playbackConfig.___workaround={},this.playbackConfig.___workaround.manifestHandler=this.playbackConfig.manifestHandler,com.zappware.chromecast.trickplayHandler.init(),this.playbackConfig.manifestHandler=this._manifestHandler.bind(this),i._playbackInfo=this._acquirePlaybackInfo(s,i).then(function(n){const r=CONFIG.adSkippingEnabled||!1,o=CONFIG.trickplayBlockingEnabled||!1,s=CONFIG.adSignallingTypeEnabled||!1;if((r||o)&&n&&com.zappware.chromecast.trickplayHandler.setPolicies(n.adPlaybackRestrictions,s?n.adSignallingType:null,n.trickplayRestrictions),i!==t._currentMedia)throw i._playbackInfo=n,DEBUG&&e("_load(): not proceeding -> received another load request!"),"_interrupted";if(!n||!n.url)throw DEBUG&&e("Failed to acquire playbackInfo!"),"_failed";return DEBUG&&e("Updating contentUrl to "+n.url),i.contentType="application/dash+xml",i.contentUrl=n.url,i._playbackInfo=n,com.zappware.chromecast.Player.prototype._load.apply(t,[a])}).catch(function(e){if(e instanceof Error&&DEBUG&&console.error(e),"_interrupted"!==e){let a,n=com.zappware.chromecast.Error.LOAD_FAILED;if(e){if(e.errors){const t=e.errors[0].errorCode.toLowerCase();n="0x02000704"===t||"0x04020001"===t?"["+t+"] "+com.zappware.chromecast.Error.SESSION_LIMIT_REACHED:"["+t+"] "+com.zappware.chromecast.Error.GRAPHQL_ERROR,a=e.errors}"string"==typeof e&&Object.values(com.zappware.chromecast.Error).includes(e)&&(n=e)}t._error(n,a),i._playbackInfo=void 0}a.media=null}).then(function(){return a}),i._playbackInfo}_manifestHandler(a){const t=document.getElementsByTagName("head")[0].innerHTML,n=this._extractString(t,"shaka-player/","/shaka-player.compiled");let r=playerManager.getMediaInformation()||this._currentMedia;try{const e=r&&r._playbackMode===com.zappware.chromecast.PlaybackMode.VOD,t=CONFIG.adSkippingEnabled||!1,n=CONFIG.trickplayBlockingEnabled||!1,o=t||n,{adBlocks:i}=o&&!e&&r&&a&&com.zappware.chromecast.manifestParserHelper.parseManifest(a);o&&!e&&r&&a&&com.zappware.chromecast.adsHandler.setAdsBlocks(i)}catch(e){console.log(e)}const o=-1===this._versionCompare(n,"3.0.0");if(-1===this._versionCompare(n,"3.0.13")&&(a=this._removeScteTags(a)),!o)return a;if(r._playbackMode===com.zappware.chromecast.PlaybackMode.STARTOVER||r._playbackMode===com.zappware.chromecast.PlaybackMode.CUTV||r._playbackMode===com.zappware.chromecast.PlaybackMode.NPVR)try{if(a.indexOf('type="dynamic"')>0){let t=a.indexOf(' mediaPresentationDuration="');for(t>0&&(DEBUG&&!this.playbackConfig.___workaround.dynamic&&e("WARNING: changing manifest on the fly to workaround shaka player issue!"),a=a.slice(0,t)+a.slice(a.indexOf('"',t+29)+1)),t=0;(t=a.indexOf(' presentationTimeOffset="',t))>0;)a=a.slice(0,t)+' presentationTimeOffset="0"'+a.slice(a.indexOf('"',t+26)+1),t+=26;this.playbackConfig.___workaround.dynamic=!0}else if(this.playbackConfig.___workaround.dynamic&&a.indexOf('type="static"')>0){DEBUG&&e("WARNING: Going from dynamic to static stream -> reload!"),this.playbackConfig.manifestHandler=this.playbackConfig.___workaround.manifestHandler,this.playbackConfig.___workaround={};let a=this._state===com.zappware.chromecast.PlayerState.PAUSED?com.zappware.chromecast.PlayerState.PAUSED:com.zappware.chromecast.PlayerState.PLAYING;com.zappware.chromecast.player.getPosition(r),CONFIG.offsetToLive;this._reacquireReloadAndSeek(r,JSON.parse(r.contentId)[0],com.zappware.chromecast.player.getPosition(r),a)}}catch(a){DEBUG&&e("Unexpected exception "+a+" in _manifestHandler()!")}return a}_loadSession(a,t){var n=this;if(CONFIG.sendKeepAliveMutation&&!this._keepSessionAliveTimer){var r=300;!function a(){n._keepAlive().then(function(t){DEBUG&&e("Next keepSessionAlive is in "+t+"s"),r=t=t||r,n._keepSessionAliveTimer=setTimeout(a,1e3*t)})}()}return a&&a._playbackInfo&&(DEBUG&&assert(!(a._playbackInfo instanceof Promise),"media._playbackInfo should not be a Promise!"),this._inauguratePlaybackInfo(a._playbackInfo,this._getBookmarkQuery(a))),Promise.resolve()}_selectPreferredTracks(a){var t=playerManager.getMediaInformation();if(t&&t._customData.playbackConfig){var n=t._customData.playbackConfig;for(var r in a=com.zappware.chromecast.util.cloneObject(a),n)n.hasOwnProperty(r)&&a.hasOwnProperty(r)&&(DEBUG&&e("Overriding config.playback."+r+" with value "+n[r]),a[r]=n[r])}return super._selectPreferredTracks(a)}pause(a=!1){if(DEBUG&&e("pause(); state = "+this._state),this._state===com.zappware.chromecast.PlayerState.LOADING)return null;var t=this,n=playerManager.getMediaInformation();if(!n||!this._canPause(n))return DEBUG&&e("Pause not supported."),com.zappware.chromecast.receiver.onPause(),null;var r=n._playbackInfo;return r instanceof Promise?r.then(function(){return t.pause()}):(n._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV&&(t._initiatePLTV(n),a=!1),super.pause(a))}_initiatePLTV(a){DEBUG&&e("_initiatePLTV()"),com.zappware.chromecast.receiver.setPlaybackMode(com.zappware.chromecast.PlaybackMode.PLTV),a._playbackMode=com.zappware.chromecast.PlaybackMode.PLTV,com.zappware.chromecast.trickplayPolicyHandler.setLastLivePoint(com.zappware.chromecast.util.getCurrentTime()),com.zappware.chromecast.trickplayPolicyHandler.setPausePoint(com.zappware.chromecast.util.getCurrentTime()),a._startPLTVat||(a._startPLTVat=com.zappware.chromecast.util.getCurrentTime(),com.zappware.chromecast.trickplayPolicyHandler.setLastLivePoint(com.zappware.chromecast.util.getCurrentTime()),com.zappware.chromecast.trickplayPolicyHandler.setPausePoint(com.zappware.chromecast.util.getCurrentTime()))}_startPLTV(a,t,n){DEBUG&&e(`_startPLTV(${t},${n})`),a._playbackInfoLive||(a._playbackInfoLive=a._playbackInfo),void 0===t&&(t=a._startPLTVat-CONFIG.offsetToLive),com.zappware.chromecast.receiver.onPlay();var r=JSON.parse(a.contentId)[1];return DEBUG&&assert("pauseLiveChannel"===r.operationName,"Unexpected query: "+JSON.stringify(r)),this._reacquireReloadAndSeek(a,r,t,n).then(function(t){if(!t||!t._playbackInfo)return DEBUG&&e("Could not start PLTV!"),com.zappware.chromecast.receiver.setPlaybackMode(com.zappware.chromecast.PlaybackMode.LIVETV),a._playbackMode=com.zappware.chromecast.PlaybackMode.LIVETV,a._playbackInfo=a._playbackInfoLive,a._playbackInfoLive=void 0,a._playbackInfo.sessionId=void 0,this._stopPLTV();t._hasPLTV=!0,t._hasTimeshiftEnabled=!0,t._playbackInfoLive=void 0,t._offsetToLive=CONFIG.offsetToLive})}_stopPLTV(){var a=playerManager.getMediaInformation()||this._currentMedia;a._playbackMode=com.zappware.chromecast.PlaybackMode.LIVETV,com.zappware.chromecast.receiver.setPlaybackMode(com.zappware.chromecast.PlaybackMode.LIVETV),delete a._startPLTVat,delete a._hasPLTV,delete a._hasTimeshiftEnabled,delete a._offsetToLive,DEBUG&&e("_stopPLTV()");var t=JSON.parse(a.contentId)[0];return DEBUG&&assert("playChannel"===t.operationName,"Unexpected query: "+JSON.stringify(t)),com.zappware.chromecast.receiver.onPlay(),this._reacquireReloadAndSeek(a,t,Number.MAX_SAFE_INTEGER)}_reacquireReloadAndSeek(e,a,t,n){var r=this;this._state=com.zappware.chromecast.PlayerState.SEEKING,com.zappware.chromecast.receiver.onBuffering(!0);var o=e._playbackInfo;return o.sessionId&&(a.variables.input.replaceSessionId=o.sessionId),this._annihilatePlaybackInfo(o),this._reloadAndSeekInProgressForPosition=t,e._playbackInfo=this._acquirePlaybackInfo(a,e).then(function(a){if(a&&a.url){const o=CONFIG.adSkippingEnabled||!1,i=CONFIG.trickplayBlockingEnabled||!1,s=CONFIG.adSignallingTypeEnabled||!1;return(o||i)&&com.zappware.chromecast.trickplayHandler.setPolicies(a.adPlaybackRestrictions,s?a.adSignallingType:null,a.trickplayRestrictions),e.contentUrl=a.url,e._playingStartedAt=com.zappware.chromecast.util.getCurrentTime(),e._playbackInfo=a,r._inauguratePlaybackInfo(e._playbackInfo),t=com.zappware.chromecast.trickplayHandler.validateRequestedPlaybackStartPositionForPLTV(t),r._reloadAndSeek(t,n).then(function(t){return t&&(t.contentUrl=a.url,t._playingStartedAt=e._playingStartedAt,t._playbackInfo=a,t._positionInfo=e._positionInfo,t._assetId=e._assetId),t})}e._playbackInfo=void 0}).catch(function(a){a instanceof Error&&DEBUG&&console.error(a),e._playbackInfo=void 0}).then(function(a){return e._playbackInfo||r._error(com.zappware.chromecast.Error.LOAD_FAILED),a||e}),e._playbackInfo}play(){if(DEBUG&&e("play(); state = "+this._state),this._state===com.zappware.chromecast.PlayerState.LOADING)return null;var a=playerManager.getMediaInformation();if(!a||!this._canPause(a))return DEBUG&&e("Play not supported."),com.zappware.chromecast.receiver.onPlay(),null;var t=a._playbackInfo;if(t instanceof Promise){var n=this;return t.then(function(){return n.play()})}var r=super.play();return!r||a._playbackMode!==com.zappware.chromecast.PlaybackMode.LIVETV&&a._playbackMode!==com.zappware.chromecast.PlaybackMode.PLTV||!a._startPLTVat||a._hasTimeshiftEnabled||a._playbackInfoLive?r:this._startPLTV(a).then(function(){return r})}_updatePositionInfo(a){if(super._updatePositionInfo(a),a._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||a._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV){if(this.isTimeshiftEnabled(a)){const t=a._playbackInfo;DEBUG&&assert(!(t instanceof Promise),"playbackInfo should not be a Promise!");const n=[],r=playerManager.getLiveSeekableRange();if(r&&r.end>r.start){let e=com.zappware.chromecast.util.getCurrentTime()-(r.end-r.start);a._offsetToLive&&(e+=a._offsetToLive),e&&n.push(e)}if(t.maximumBufferSize){const e=a._positionInfo.maxPosition-t.maximumBufferSize;e&&n.push(e)}if(t.streamStart){const e=new Date(t.streamStart).getTime()/1e3;e&&n.push(e)}if(n.length>0)return a._positionInfo.minPosition=Math.max(...n),a._positionInfo.curPosition=Math.max(Math.min(this._getCurrentPosition(a)||Number.MAX_SAFE_INTEGER,a._positionInfo.maxPosition),a._positionInfo.minPosition),void(this._state===com.zappware.chromecast.PlayerState.PAUSED&&a._positionInfo.curPosition<=a._positionInfo.minPosition&&(DEBUG&&e("Auto-resuming at start of TSB"),playerManager.play()))}if(a._startPLTVat&&!a._hasTimeshiftEnabled){let e=com.zappware.chromecast.util.getCurrentTime();return a._positionInfo.minPosition=e-CONFIG.maxPLTVBufferSize,a._positionInfo.maxPosition=e,void(a._positionInfo.curPosition=Math.max(Math.min(this._getCurrentPosition(a)||Number.MAX_SAFE_INTEGER,a._positionInfo.maxPosition),a._positionInfo.minPosition))}a._positionInfo.minPosition=a._positionInfo.curPosition}}_inauguratePlaybackInfo(a,t){if(a){if(a.heartbeat&&!a.heartbeat._timer){var n=a.heartbeat.interval||300;DEBUG&&e("Setting heartbeat interval to "+n+"s"),a.heartbeat._timer=setInterval(function(){DEBUG&&e("Sending heartbeat to "+a.heartbeat.url),com.zappware.chromecast.util.httpGet(a.heartbeat.url,{"Content-Type":"application/json"})},1e3*n)}!a._bookmarkTimer&&t&&(DEBUG&&e("Setting bookmark interval to "+CONFIG.bookmarkInterval+"s"),a._bookmarkTimer=setInterval(()=>this._setBookmark(),1e3*CONFIG.bookmarkInterval))}}_annihilatePlaybackInfo(a){a&&(DEBUG&&e("_annihilatePlaybackInfo() for sessionId "+a.sessionId),DEBUG&&assert(!(a instanceof Promise),"media._playbackInfo should not be a Promise!"),a.heartbeat._timer&&(clearInterval(a.heartbeat._timer),a.heartbeat._timer=void 0),a._bookmarkTimer&&(clearInterval(a._bookmarkTimer),a._bookmarkTimer=void 0),a.sessionId=void 0)}_acquirePlaybackInfo(r,o){var i=this;switch(r.operationName){case"pauseLiveChannel":var s=o._startPLTVat-60;if(r.variables.input.pausedAt=new Date(1e3*s).toISOString(),r.variables.input.eventId=com.zappware.chromecast.receiver.getCurrentEvent().id||o._currentEventId||null,r.variables.input.eventId instanceof Promise)return r.variables.input.eventId.then(function(){return i._acquirePlaybackInfo(r,o)});case"playChannel":case"playRecording":case"catchupEvent":case"restartEvent":case"playVODAsset":case"playTrailer":if(!r.query){const e=CONFIG.adSkippingEnabled||!1,o=CONFIG.adSignallingTypeEnabled||!1,i=CONFIG.trickplayBlockingEnabled||!1,s=e||i;r.query=s?o?n[r.operationName].query:t[r.operationName].query:a[r.operationName].query;var c=s?o?n[r.operationName].variables:t[r.operationName].variables:a[r.operationName].variables;for(var p in c)c.hasOwnProperty(p)&&!r.variables.hasOwnProperty(p)&&(r.variables[p]=c[p])}break;default:return DEBUG&&e("Unsupported query: '"+r.operationName+"'"),Promise.resolve()}return DEBUG&&e("_acquirePlaybackInfo(); query: "+JSON.stringify(r)),new Promise(function(a,t){i._graphql(r).then(function(n){DEBUG&&e("response = "+JSON.stringify(n)),n&&(n.data&&n.data[r.operationName]&&a(n.data[r.operationName].playbackInfo),n.errors&&t(n)),a(void 0)}).catch(function(a){DEBUG&&e("something went wrong in _acquirePlaybackInfo(): "+a),t(a)})}).then(function(a){return CONFIG.broadpeakHeartbeatInterval&&a&&a.url?com.zappware.chromecast.util.httpGetRedirectURL(a.url,void 0,!1).then(function(t){return DEBUG&&e("_acquirePlaybackInfo() yields "+t+" as redirect URL for "+a.url),a.url=t,a}).catch(function(t){return DEBUG&&e("Failed to get redirect URL for "+a.url+"!"),a}):a})}setPosition(a,t){if(DEBUG&&e("setPosition("+a+"); state = "+this._state),this._state===com.zappware.chromecast.PlayerState.LOADING)return null;var n=this,r=playerManager.getMediaInformation();if(!r||!this._canSeek(r))return DEBUG&&e("setPosition() not supported."),com.zappware.chromecast.receiver.onPlay(),null;var o=r._playbackInfo;if(o instanceof Promise)return o.then(function(){return n.setPosition(a,t)});if(r._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||r._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV)if(a+10<n.getMaxPosition()){if(r._startPLTVat||this._initiatePLTV(r),!r._hasTimeshiftEnabled&&!r._playbackInfoLive)return this._startPLTV(r,a,t)}else if(r._startPLTVat)return this._stopPLTV();return super.setPosition(a,t)}shutdown(){if(!this._shuttingDown){this._shuttingDown=!0;var e=playerManager.getMediaInformation()||this._currentMedia;if(CONFIG.broadpeakHeartbeatInterval&&e&&e.contentUrl&&com.zappware.chromecast.util.httpGet(e.contentUrl+"/teardown",void 0,!1).catch(()=>void 0),e&&e._playbackInfo&&(this._setBookmark(e),e._playbackInfo.sessionId)){var t=com.zappware.chromecast.util.cloneObject(a.stopPlayback);t.variables.input={sessionId:e._playbackInfo.sessionId},this._graphql(t,e)}}}onMediaStalled(){DEBUG&&e("onMediaStalled()");var a=playerManager.getMediaInformation()||this._currentMedia;if(!this._stalledPromise){com.zappware.chromecast.receiver.onBuffering(!0);var t=playerManager.getCurrentTimeSec()+1;if(a._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV){var n=playerManager.getLiveSeekableRange();n&&n.end&&(t=n.end-10)}DEBUG&&e("Media stalled: calling seek "+t),playerManager.seek(t);var r=this;this._stalledPromise=this._waitForEvent("SEEKED").then(function(){a!==r._currentMedia||r._state!==com.zappware.chromecast.PlayerState.PLAYING&&r._state!==com.zappware.chromecast.PlayerState.PAUSED||com.zappware.chromecast.receiver.onBuffering(!1),r._stalledPromise=void 0})}}canPause(e,a){e=e||playerManager.getMediaInformation();const t=!a||com.zappware.chromecast.trickplayHandler.canPause();return e._playbackMode===com.zappware.chromecast.PlaybackMode.LIVETV||e._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV?this._hasPLTV(e)&&t:t}isTimeshiftEnabled(e,a){if(e=e||playerManager.getMediaInformation(),this._hasPLTV(e)){var t=e._playbackInfo||{};if(t.maximumBufferSize||t.streamStart)return!0}return!1}_hasPLTV(e){if(void 0===e._hasPLTV){var a=JSON.parse(e.contentId)[1];e._hasPLTV=a&&"pauseLiveChannel"===a.operationName}return e._hasPLTV}_canPause(e){return e._playbackMode!==com.zappware.chromecast.PlaybackMode.LIVETV&&e._playbackMode!==com.zappware.chromecast.PlaybackMode.PLTV||this._hasPLTV(e)}_canSeek(e){return e._playbackMode!==com.zappware.chromecast.PlaybackMode.LIVETV&&e._playbackMode!==com.zappware.chromecast.PlaybackMode.PLTV||this._hasPLTV(e)}_stop(t){var n=this;if(t._playbackInfo instanceof Promise)return t._playbackInfo.then(function(){return n._stop(t)});if(t._playbackInfo){if(clearInterval(t._playbackInfo.heartbeat._timer),t._playbackInfo._bookmarkTimer&&(this._setBookmark(t),clearInterval(t._playbackInfo._bookmarkTimer)),t._playbackInfo.sessionId){var r=com.zappware.chromecast.util.cloneObject(a.stopPlayback);return r.variables.input={sessionId:t._playbackInfo.sessionId},delete t._playbackInfo.sessionId,delete t._playbackInfo,DEBUG&&e("_stop(); query: "+JSON.stringify(r)),this._graphql(r,t).then(function(a){DEBUG&&a&&a.errors&&e("stopPlayback failed: "+JSON.stringify(a.errors))})}return Promise.resolve()}}_keepAlive(){return DEBUG&&e("_keepAlive(); query: "+JSON.stringify(a.keepAlive)),this._graphql(a.keepAlive).then(function(e){return e&&e.data&&e.data.keepSessionAlive.sessionTimeout})}_getCurrentEvent(t){t=t||playerManager.getMediaInformation()||this._currentMedia;var n=a.getCurrentEvent;return n.variables={channelId:t._assetId,time:(new Date).toISOString()},DEBUG&&e("_getCurrentEvent(); query: "+JSON.stringify(n)),this._graphql(n,t).then(function(a){return DEBUG&&e("response = "+JSON.stringify(a)),a&&a.data&&a.data.channel.eventsAt.items[0]})}_getBookmarkQuery(e,t){var n,r=(e=e||playerManager.getMediaInformation()||this._currentMedia)._customData.profileId,o=JSON.parse(e.contentId)[0];switch(o.operationName){case"playVODAsset":(n=com.zappware.chromecast.util.cloneObject(a.setVODBookmark)).variables.profileId=r,n.variables.input={profileId:r,vodAssetId:o.variables.input.vodAssetId,position:Math.floor(t)};break;case"catchupEvent":case"restartEvent":(n=com.zappware.chromecast.util.cloneObject(a.setEventBookmark)).variables.profileId=r,n.variables.input={profileId:r,eventId:o.variables.input.eventId,position:Math.floor(t)};break;case"playRecording":(n=com.zappware.chromecast.util.cloneObject(a.setRecordingBookmark)).variables.profileId=r,n.variables.input={profileId:r,recordingId:o.variables.input.recordingId,position:Math.floor(t)}}return n}_setBookmark(a){if((a=a||playerManager.getMediaInformation()||this._currentMedia)&&a._playbackInfo&&a._playbackInfo._bookmarkTimer&&com.zappware.chromecast.util.getCurrentTime()-a._playingStartedAt>=60){let t=this.getPosition(a);if(t>0){let n=this._getBookmarkQuery(a,t);return DEBUG&&assert(n,"No bookmark query."),DEBUG&&e("_setBookmark(); query: "+JSON.stringify(n)),this._graphql(n,a)}}}_logout(){return this._graphql({operationName:"logout",variables:{},query:"mutation logout {\n  logout\n}\n"})}_graphql(e){}_extractString(e,a,t){const n=e.indexOf(a),r=e.indexOf(t,n);if(-1!=n&&-1!=r&&r>n){let t=e.substring(n,r);return t=t.replace(a,"")}return-1}_versionCompare(e,a,t){var n=t&&t.lexicographical,r=t&&t.zeroExtend,o=e.split("."),i=a.split(".");function s(e){return(n?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!o.every(s)||!i.every(s))return NaN;if(r){for(;o.length<i.length;)o.push("0");for(;i.length<o.length;)i.push("0")}n||(o=o.map(Number),i=i.map(Number));for(var c=0;c<o.length;++c){if(i.length==c)return 1;if(o[c]!=i[c])return o[c]>i[c]?1:-1}return o.length!=i.length?-1:0}_removeScteTags(e){const a='<EventStream schemeIdUri="urn:scte:scte35';for(;;){let t=this._extractString(e,a,"</EventStream>");if(-1===t)break;t=a+t+"</EventStream>",e=e.replace(t,"")}return e}}}(),com.zappware.chromecast.manifestParserHelper=function(){function e(e,t,n,r){if(!e)return;const o=com.zappware.chromecast.adsHandler.getAdSignallingType();if(o===com.zappware.chromecast.AdSignallingTypes.SCTE35_ZW_1)return a(e,t,n,r);if(o===com.zappware.chromecast.AdSignallingTypes.DEFAULT){const o=i(t),c=e.start;let p=c&&c.substring(2,c.length-1),l=c&&!_.isEqual(p,"0")&&p;if(o)return a(e,t,n,r);return s(t,n,r,l).map(e=>({adId:e.adId,adStartTime:parseInt(e.start),adEndTime:parseInt(e.end),totalDuration:e.duration,adType:e.adType}))}return{}}function a(e,a,n,r){let i=e.start,s="dynamic"===n&&(r&&r.UTCTiming[0].value||"https://time.akamai.com/?iso"),c="dynamic"===n&&o(e,n,s),p="dynamic"===n?c:i.substring(2,i.length-1),l=a.Event[0]&&a.Event[0].duration||e.duration,m=e.duration||0,d=a.Event[0]&&a.Event[0].duration,u=a&&a.timescale,h=m&&m.indexOf("M"),y=m&&m.indexOf("S"),g=m&&h>-1&&m.substring(2,h),f=m&&h>-1&&y>-1?m.substring(h+1,y):h>-1&&-1===y?0:h<=-1&&y>-1?m.substring(2,y):0,_=g&&t(g),k=d?d/(u||18e4):_?parseFloat(_)+parseFloat(f):parseFloat(f),v=void 0===l?p:k+parseFloat(p);return{adId:a.Event[0].id,adStartTime:parseInt(p),adEndTime:parseInt(v),totalDuration:k,adType:"TYPE_SCTE35"}}function t(e){return 60*e}function n(e="https://time.akamai.com/?iso"){var a=new XMLHttpRequest;return a.open("GET",e,!1),a.send(null),a.responseText}function r(e){return(e=new Date(e)).getTime()/1e3}function o(e,a,t){if("dynamic"!==a)return;let o=com.zappware.chromecast.util.getCurrentTime()-r(n(t)),i=e.start;return i.substring(2,i.length-1)-o}function i(e){let a;return e.Event.map(e=>0===parseInt(e.presentationTime)?(a=!0,!0):(a=!1,!1)),a}function s(e,a,t,n){let r=e.timescale;return e.Event.map(e=>{let o="dynamic"===a&&(t&&t.UTCTiming[0].value||"https://time.akamai.com/?iso"),i="dynamic"===a&&c(a,o,e,r,n),s="dynamic"===a?i:n||e.presentationTime/r,p=e.duration/r;return{start:s,duration:p,end:parseFloat(s)+parseFloat(p),adId:e.id,adType:"TYPE_SCTE35"}})}function c(e,a,t,o,i){if("dynamic"!==e)return;let s=com.zappware.chromecast.util.getCurrentTime(),c=r(n(a)),p=parseInt(s-c);return(i||t.presentationTime/o)-p}return{parseManifest:function(a){if(!a)return;var t=parser.validate(a);!0!==t&&console.log(t.err);var n=parser.parse(a,{attributeNamePrefix:"",textNodeName:"#text",ignoreAttributes:!1,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!0,trimValues:!0,decodeHTMLchar:!0,cdataTagName:"__cdata",cdataPositionChar:"\\c",arrayMode:!0,parseTrueNumberOnly:!1});let r=[];if(n){let t=n.MPD[0],o=t&&t.Period;o&&o.some(e=>Object.keys(e).includes("EventStream"))?o.map(n=>{if(n.EventStream&&n.EventStream[0].schemeIdUri.indexOf("scte")){let o=a.indexOf('type="dynamic"')>0?"dynamic":"static",i=e(n,n.EventStream[0],o,t);i&&r.push(i)}else console.log("")}):console.log("")}return{jsonManifestObj:n,adBlocks:r}},getAdsBlockInfo:e,convertMinutesToSeconds:t,checkKeyPresenceInArray:function(e,a){a.some(a=>Object.keys(a).includes(e))},fetchManifestUtcTime:n,convertDateToSeconds:r,toDateTime:function(e){var a=new Date(1970,0,1);return a.setSeconds(e),a},calculateStartTimeForDynamicStream:o,checkForPresentationTime:i,calculateWhenPresentationTimeIsNotZero:s,dynamicLogicForNonZeroPTime:c}}(),com.zappware.chromecast.TagPlayer=function(){var e=function(e){com.zappware.chromecast.util.log("com.zappware.chromecast.TagPlayer",e)};return class extends com.zappware.chromecast.Nexx4Player{constructor(){super()}_load(a){if(DEBUG&&e("_load()"),TAG_CONFIG.pathLic){var t=this.getPlaybackConfig();t.protectionSystem=cast.framework.ContentProtection.WIDEVINE,t.licenseUrl=TAG_CONFIG.pathLic,t.licenseRequestHandler=function(e){var t=a.media;e.url=TAG_CONFIG.pathLic.replace("$DEVICE_ID$",base64.encode(t._customData.sessionParams.device_id)),e.withCredentials=!1}}return com.zappware.chromecast.Nexx4Player.prototype._load.apply(this,[a])}_checkToken(a){DEBUG&&assert(a&&a.device_id&&a.token,"Invalid parameter for _checkToken: "+JSON.stringify(a));var t=new URLSearchParams;t.set("devId",a.device_id),t.set("token",a.token),t.set("apply",!0);var n=TAG_CONFIG.pathEvo+"/auth/CheckToken?"+t.toString();return DEBUG&&e("CheckToken -> url: "+n),com.zappware.chromecast.util.httpGet(n).then(function(e){if(e)return JSON.parse(e).token}).catch(function(a){DEBUG&&e("CheckToken failed on DS EVO "+(a?a.message:void 0))})}_cloneToken(a){DEBUG&&assert(a&&a.device_id,"Invalid parameter for _cloneToken: "+JSON.stringify(a));var t=new URLSearchParams;t.set("devId",a.device_id);var n=TAG_CONFIG.pathEvo+"/auth/CloneToken?"+t.toString();return DEBUG&&e("CloneToken -> url: "+n),com.zappware.chromecast.util.httpGet(n).then(function(e){if(e)return JSON.parse(e).token}).catch(function(a){DEBUG&&e("CloneToken failed on SDS EVO "+(a?a.message:void 0))})}_logout(a){if(!a){var t=playerManager.getMediaInformation()||this._currentMedia;a=t&&t._customData.sessionParams}if(a&&a.cloned_token){var n=TAG_CONFIG.pathEvo+"/auth/Logout";return DEBUG&&e("Logout -> url: "+n),com.zappware.chromecast.util.httpGet(n).then(function(e){if(e)return JSON.parse(e).token}).catch(function(a){DEBUG&&e("Logout failed on SDS EVO "+(a?a.message:void 0))})}}shutdown(){this._logout(),super.shutdown()}_graphql(a,t,n,r,o){var i=this;if(r||(t=t||playerManager.getMediaInformation()||this._currentMedia,r=t&&t._customData&&t._customData.sessionParams),r&&!r.cloned_token&&!o&&!n)return DEBUG&&e("No cloned token -> acquire a cloned token first, then retry."),TAG_CONFIG.pathEvo.endsWith("/auth")&&(TAG_CONFIG.pathEvo=TAG_CONFIG.pathEvo.slice(0,-5)),this._checkToken(r).then(function(){return i._cloneToken(r).then(function(e){return e&&(r.cloned_token=e),i._graphql(a,t,n,r,!0)})});if(!(r&&r.device_id&&r.cloned_token&&r.user_id))return DEBUG&&e("No or invalid session parameters to do graphql request."),Promise.resolve();let s={"Content-Type":"application/json","Zappware-User-Agent":TAG_CONFIG.ZappwareUserAgent,SDSEVO_DEVICE_ID:r.device_id,SDSEVO_SESSION_ID:r.cloned_token,SDSEVO_USER_ID:r.user_id};return n?com.zappware.chromecast.util.httpPostSync(TAG_CONFIG.pathMW,s,JSON.stringify(a)):com.zappware.chromecast.util.httpPost(TAG_CONFIG.pathMW,s,JSON.stringify(a)).catch(function(t){DEBUG&&e("graphql request failed [Error: "+JSON.stringify(t)+", Request: "+JSON.stringify(a)+"]"),a._fail||(r.cloned_token=void 0,a._fail=t)}).then(function(e){return e?(delete a._fail,JSON.parse(e)):void 0===r.cloned_token?i._graphql(a,t,n,r):void 0})}}}(),com.zappware.chromecast.player=new com.zappware.chromecast.TagPlayer,com.zappware.chromecast.adsHandler=function(){const e=CONFIG.adSkippingEnabled||!1;let a=null,t=null,n="DEFAULT",r=[],o={},i=[],s="";const c=e=>{t&&(a=e,console.log("adsHandler - Entered SCTE35 ad block:",e))},p=e=>{console.log("adsHandler - Exiting and removing SCTE35 ad block:",e),o[e.adId]=!0,l(e),a=null},l=e=>{r=r.filter(a=>a.adId!=e.adId)},m=(e,a,t,n)=>{if(!e)return;if(o[e])return;mediaInfo=playerManager.getMediaInformation();const i=mediaInfo&&mediaInfo.metadata&&mediaInfo.metadata.customData&&JSON.parse(mediaInfo.metadata.customData);i&&a>new Date("2000").getTime()&&(a-=i.start,t-=i.start);const s={id:0===r.length?0:_.last(r).id+1,adId:e,adStartTime:a,adEndTime:t,adType:n};if(a<0)return;if(a===t)return void console.log("adsHandler - Ignored new ad block since the duration is 0.",s);const c=u(a,t,e);c?console.log("adsHandler - Ignored new ad block: already in the list.",c):(r.push(s),console.log("adsHandler - Added ad block to the list",s))},d=(e,a)=>(console.log("adsHandler - Finding ads before",e),_.find(r,t=>e>t.adStartTime&&t.adEndTime>a)),u=(e,a,t)=>_.find(r,n=>(!t||n.adId===t)&&n.adStartTime===e&&n.adEndTime===a),h=()=>{const e=playerManager.getMediaInformation();return s=e._playbackMode};return{validateRequestedSeekPosition:(n,r)=>{if(!e)return n;console.log("adsHandler - Validating requested playback position",n,"...");const o=playerManager.getMediaInformation(),i=o&&o.metadata&&o.metadata.customData&&JSON.parse(o.metadata.customData).customData;if(i&&i.startOverTVBeforeTime&&n===i.startOverTVBeforeTime)return n;let s=n;if(t&&!a&&!(r>=n)){const e=d(n,r);e&&(console.log("... found a unseen ads block, jumping to it.",e),s=e.adStartTime+.2)}return s},canSeek:(t,r)=>{if(!e)return!0;const o=playerManager.getMediaInformation(),i=o&&o._playbackMode===com.zappware.chromecast.PlaybackMode.VOD;return"UNKNOWN"===n?!(!i&&position>r&&(com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("blockTrickPlayOnChannelLevel"),1)):!(a&&t>r&&(com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("blockSkipAd"),1))},checkAdEnterExit:()=>{if(!e)return;const t=com.zappware.chromecast.trickplayHandler.getCurrentTimeSec();if(a&&a.adEndTime<t&&p(a),a&&a.adStartTime>t&&(a=null),!a){let e=null;r.forEach(a=>{t>=a.adStartTime&&t<=a.adEndTime&&(e=a)}),e&&c(e)}},setPolicy:(a,r)=>{e&&(_.forEach(a,e=>{t="BLOCK_SKIP_AND_FAST_FORWARD"===e?{allow_skip:!1}:void 0}),n="SCTE35_ZW_1"===r?com.zappware.chromecast.AdSignallingTypes.SCTE35_ZW_1:null===r?com.zappware.chromecast.AdSignallingTypes.DEFAULT:com.zappware.chromecast.AdSignallingTypes.UNKNOWN)},setAdsBlocks:e=>{if(r=[],!e)return;_.map(e,e=>{e&&(e instanceof Array&&e.map(e=>{m(e.adId,e.adStartTime,e.adEndTime,e.adType)}),m(e.adId,e.adStartTime,e.adEndTime,e.adType))}),h()===com.zappware.chromecast.PlaybackMode.PLTV&&(t&&t.allow_skip||(console.log("adsHandler - Removing all ads blocks in live viewed window"),_.remove(r,e=>-1!==_.findIndex(i,a=>e.adStartTime>=a.startTime&&e.adEndTime<=a.endTime))))},getAdsBlocks:()=>r,getAdSignallingType:()=>n,init:()=>{if(!e)return;console.log("adsHandler - RESET ads:"),r=[],a=null,t=null,trickplayPolicy=null,o={},com.zappware.chromecast.player.getState()===com.zappware.chromecast.PlayerState.STOPPED&&(i=[]);let n=h();console.log("adsHandler - init"),n===com.zappware.chromecast.PlaybackMode.LIVETV&&(i=[{}])},setTimingForViewedWindow:e=>{const a=_.last(i);h()===com.zappware.chromecast.PlaybackMode.LIVETV&&(a.startTime||(a.startTime=e),a.startTime&&(void 0===a.endTime||e>a.endTime)&&(a.endTime=e))}}}(),com.zappware.chromecast.AdSignallingTypes={DEFAULT:"DEFAULT",SCTE35_ZW_1:"SCTE35_ZW_1",UNKNOWN:"UNKNOWN"},com.zappware.chromecast.trickplayPolicyHandler=function(){const e=CONFIG.trickplayBlockingEnabled||!1;let a={},t=null,n=null,r=!1;const o=e=>{if(!e)return;_.isEmpty(e)||(r=!0);const t=_.includes(e,com.zappware.chromecast.TrickPlayRestriction.SKIP_FORWARD),n=_.includes(e,com.zappware.chromecast.TrickPlayRestriction.SKIP_BACKWARD),o=_.includes(e,com.zappware.chromecast.TrickPlayRestriction.PAUSE);a={allow_forward:!t,allow_backward:!n,allow_pause:!o}},i=()=>a;return{init:()=>{a=null,t=null,n=null,r=!1},setPolicy:(e=null)=>{o(e)},hasRestrictions:()=>e&&r,canSeek:(e,a)=>{const t=playerManager.getMediaInformation()._playbackMode===com.zappware.chromecast.PlaybackMode.VOD,n=i();return!(n&&!t&&(!1===n.allow_forward&&e>a?(com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("trickPlayRestrictions"),1):!1===n.allow_backward&&e<a&&(com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("trickPlayRestrictions"),1)))},canPause:()=>{const e=playerManager.getMediaInformation()._playbackMode;if(!a)return!0;if(e===com.zappware.chromecast.PlaybackMode.LIVETV)return!0;if(e===com.zappware.chromecast.PlaybackMode.VOD)return!0;if(!1===a.allow_pause){const e=com.zappware.chromecast.player.getState();return e&&e!==com.zappware.chromecast.PlayerState.SEEKING&&com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("trickPlayRestrictions"),e===com.zappware.chromecast.PlayerState.PAUSED}return!0},setLastLivePoint:e=>{t=e},setPausePoint:e=>{n=e},validateRequestedPlaybackStartPositionForPLTV:e=>{const n=e||com.zappware.chromecast.trickplayHandler.getCurrentTimeSec();let r;if(playerManager.getMediaInformation()._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV&&null!==n&&null!==t){if(t&&n<t&&!1===a.allow_backward)return com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("trickPlayRestrictions"),r=t,t=null,r;if(t&&n>t&&!1===a.allow_forward)return com.zappware.chromecast.trickplayHandler.showBlockTrickplayMessage("trickPlayRestrictions"),r=t,t=null,r;t=null}return e}}}(),com.zappware.chromecast.TrickPlayRestriction={PAUSE:"PAUSE",SKIP_FORWARD:"SKIP_FORWARD",SKIP_BACKWARD:"SKIP_BACKWARD"},com.zappware.chromecast.trickplayHandler=function(){const e=()=>{let e;return e=playerManager.getMediaInformation()._playbackMode===com.zappware.chromecast.PlaybackMode.PLTV?playerManager.getMediaInformation().startAbsoluteTime+playerManager.getCurrentTimeSec():playerManager.getCurrentTimeSec()};return{init:()=>{com.zappware.chromecast.trickplayPolicyHandler.init(),com.zappware.chromecast.adsHandler.init()},setPolicies:(e,a,t)=>{com.zappware.chromecast.trickplayPolicyHandler.setPolicy(t),com.zappware.chromecast.adsHandler.setPolicy(e,a)},canSeek:a=>{const t=e();if(com.zappware.chromecast.trickplayPolicyHandler.hasRestrictions())return com.zappware.chromecast.trickplayPolicyHandler.canSeek(a,t);return com.zappware.chromecast.adsHandler.canSeek(a,t)},getCurrentTimeSec:e,validateRequestedSeekPosition:a=>{const t=e();return com.zappware.chromecast.trickplayPolicyHandler.hasRestrictions()?a:com.zappware.chromecast.adsHandler.validateRequestedSeekPosition(a,t)},canPause:()=>!com.zappware.chromecast.trickplayPolicyHandler.hasRestrictions()||com.zappware.chromecast.trickplayPolicyHandler.canPause(),showBlockTrickplayMessage:e=>{const a=document.querySelector("#blocktrickplayInfo");""===a.innerText&&(a.innerText=com.zappware.chromecast.globaltext.getString(e),setTimeout(()=>{a.innerText=""},7e3))},validateRequestedPlaybackStartPositionForPLTV:e=>com.zappware.chromecast.trickplayPolicyHandler.hasRestrictions()?com.zappware.chromecast.trickplayPolicyHandler.validateRequestedPlaybackStartPositionForPLTV(e):e}}();